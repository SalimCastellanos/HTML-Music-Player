self.DEBUGGING=!1,function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.TrackAnalyzer=t()}}(function(){var t,e,n;return function r(t,e,n){function i(a,s){if(!e[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=e[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,r,t,e,n)}return e[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,n){"use strict";e.exports=function(){var e=t("events"),n={};return n.createDomain=n.create=function(){function t(t){n.emit("error",t)}var n=new e.EventEmitter;return n.add=function(e){e.on("error",t)},n.remove=function(e){e.removeListener("error",t)},n.bind=function(e){return function(){var n=Array.prototype.slice.call(arguments);try{e.apply(null,n)}catch(r){t(r)}}},n.intercept=function(e){return function(n){if(n)t(n);else{var r=Array.prototype.slice.call(arguments,1);try{e.apply(null,r)}catch(n){t(n)}}}},n.run=function(e){try{e()}catch(n){t(n)}return this},n.dispose=function(){return this.removeAllListeners(),this},n.enter=n.exit=function(){return this},n},n}.call(this)},{events:2}],2:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function a(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!o(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,o,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(a(n))for(o=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,u=0;r>u;u++)l[u].apply(this,o);return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?a(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,a(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,o,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],o=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(a(n)){for(s=o;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=s;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){function r(){c=!1,s.length?l=s.concat(l):f=-1,l.length&&i()}function i(){if(!c){var t=setTimeout(r);c=!0;for(var e=l.length;e;){for(s=l,l=[];++f<e;)s&&s[f].run();f=-1,e=l.length}s=null,c=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function a(){}var s,u=e.exports={},l=[],c=!1,f=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new o(t,e)),1!==l.length||c||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=a,u.addListener=a,u.once=a,u.off=a,u.removeListener=a,u.removeAllListeners=a,u.emit=a,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],4:[function(t,e,n){"use strict";function r(){var t=d.open(s,a);this.db=o.IDBPromisify(t),this.db.suppressUnhandledRejections(),this._onUpgradeNeeded=this._onUpgradeNeeded.bind(this),t.onupgradeneeded=this._onUpgradeNeeded}const i=t("lib/bluebird"),o=t("lib/util"),a=3,s="TagDatabase",u="trackUid",l="album",c="trackInfo",f="coverart",h="readwrite",p="readonly",d=self.indexedDB||self.mozIndexedDB||self.msIndexedDB;r.prototype._onUpgradeNeeded=function(t){var e=t.target.result,n=i.resolve(),r=i.resolve();try{n=e.createObjectStore(c,{keyPath:u}),n=o.IDBPromisify(n.transaction)}catch(a){}try{r=e.createObjectStore(f,{keyPath:l}),r=o.IDBPromisify(r.transaction)}catch(a){}this.db=i.all([n,r]).thenReturn(e)},r.prototype.query=function(t){return this.db.then(function(e){return o.IDBPromisify(e.transaction(c).objectStore(c).get(t))})},r.prototype.getAlbumImage=function(t){return t?this.db.then(function(e){return o.IDBPromisify(e.transaction(f).objectStore(f).get(t))}):i.resolve(null)},r.prototype.setAlbumImage=function(t,e){return t?(t=t.toLowerCase(),this.db.then(function(n){var r=n.transaction(f,h).objectStore(f),i={album:t,url:e};return o.IDBPromisify(r.put(i))})):i.resolve(null)},r.prototype.insert=function(t,e){e.trackUid=t;var n=this;return this.db.then(function(e){var n=e.transaction(c,p).objectStore(c);return o.IDBPromisify(n.get(t))}).then(function(t){var r=n.db.value().transaction(c,h).objectStore(c),i=o.assign({},t||{},e);return o.IDBPromisify(r.put(i))})};const _=function(t){return function(e,n){var r=this;return this.db.then(function(t){var n=t.transaction(c,p).objectStore(c);return o.IDBPromisify(n.get(e))}).then(function(i){var a=r.db.value().transaction(c,h).objectStore(c);return i=Object(i),i.trackUid=e,i[t]=n,o.IDBPromisify(a.put(i))})}};r.prototype.updateAcoustId=_("acoustId"),r.prototype.updateRating=_("rating"),r.prototype.updateHasCoverArt=_("hasCoverArt"),self.removeTrackInfo=function(t){return v.db.then(function(e){var n=e.transaction(c,h).objectStore(c);n["delete"](t)})};var v=new r;e.exports=v},{"lib/bluebird":17,"lib/util":23}],5:[function(t,e,n){"use strict";function r(t,e){this.src=t,this.srcLength=e,this.offset=c,this.noteBufferIndex=0,this.coeff=1,this.row=0,this.bitsIndex=0;for(var n=0;f>n;++n)p[n]=this.src[n]}var i=t("lib/realfft");const o=t("lib/bluebird"),a=t("audio/AcoustIdApiError"),s=t("lib/util"),u=t("TagDatabase"),l=11025,c=1365,f=4096,h=2048,p=new Float64Array(f),d=12,_=Math.ceil(1318904/c),v=new Float64Array([.25,.75,1,.75,.25]),m=new Float64Array(d),y=new Float64Array(_*d),g=new Float64Array(96),b=(2*Math.PI,2*Math.pow(Math.sin(-Math.PI/f),2)),w=Math.sin(2*-Math.PI/f),E=10,C=1308,A=27.5,k=new Uint8Array(31680),x=new Uint8Array("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split("").map(function(t){return t.charCodeAt(0)})),R=function(t,e){return Math.log(1+t)-Math.log(1+e)},S=function(t,e,n,r){if(t>n||e>r)return 0;var i=y[12*n+r];return t>0&&(i-=y[12*(t-1)+r],e>0&&(i+=y[12*(t-1)+(e-1)])),e>0&&(i-=y[12*n+(e-1)]),i},F=function(t,e,n,r){return n>t?e>t?0:1:r>t?3:2},T=function(t,e,n,r,i,o,a){return F(R(S(t,e,t+r-1,e+n-1),0),i,o,a)},j=function(t,e,n,r,i,o,a){const s=n/2|0;return F(R(S(t,e+s,t+r-1,e+n-1),S(t,e,t+r-1,e+s-1)),i,o,a)},I=function(t,e,n,r,i,o,a){const s=r/2|0;return F(R(S(t+s,e,t+r-1,e+n-1),S(t,e,t+s-1,e+n-1)),i,o,a)},O=function(t,e,n,r,i,o,a){const s=n/2|0,u=r/2|0,l=S(t,e+s,t+u-1,e+n-1)+S(t+u,e,t+r-1,e+s-1),c=S(t,e,t+u-1,e+s-1)+S(t+u,e+s,t+r-1,e+n-1);return F(R(l,c),i,o,a)},M=function(t,e,n,r,i,o,a){const s=n/3|0,u=S(t,e+s,t+r-1,e+2*s-1),l=S(t,e,t+r-1,e+s-1)+S(t,e+2*s,t+r-1,e+n-1);return F(R(u,l),i,o,a)},P=function(t,e,n,r,i,o,a){const s=r/3|0,u=S(t+s,e,t+2*s-1,e+n-1),l=S(t,e,t+s-1,e+n-1)+S(t+2*s,e,t+r-1,e+n-1);return F(R(u,l),i,o,a)};r.prototype.fill=function(){var t=this.offset;if(t+f-1>=this.srcLength)return!1;for(var e=this.src,n=0;f>n;++n)p[n]=e[t+n];return this.offset+=c,!0},r.prototype.hammingWindow=function(){for(var t,e=1,n=0,r=0;f>r;++r)p[r]*=.54-.46*e,t=e-(b*e+w*n),n+=w*e-b*n,e=t},r.prototype.chroma=function(){for(var t=this.noteBufferIndex*d,e=0;d>e;++e)g[t+e]=0;for(var e=E;C>e;++e){var n=Math.log(e*l/f/A)/Math.LN2,r=d*(n-Math.floor(n))|0,i=p[e],o=p[e+h],a=i*i+o*o;g[t+r]+=a}if(this.noteBufferIndex=this.noteBufferIndex+1&7,this.coeff>=5){for(var s=this.noteBufferIndex+3&7,u=0,e=0;d>e;++e){m[e]=0;for(var c=0;5>c;++c){var _=(s+c&7)*d+e,b=g[_]*v[c];m[e]+=b}u+=m[e]*m[e]}u=Math.sqrt(u);var w=this.row,c=w*d;if(.01>u)for(var e=0;d>e;++e)y[c++]=0;else for(var e=0;d>e;++e)y[c]=m[e]/u,c++;this.row++}else this.coeff++},r.prototype.transformImage=function(){for(var t=this.row,e=1,n=1;12>n;++n)y[n]=y[n]+y[n-1],e++;for(var r=0,n=1;t>n;++n){y[e]=y[e]+y[r],e++,r++;for(var i=1;12>i;++i)y[e]=y[e]+y[e-1]+y[r]-y[r-1],e++,r++}},r.prototype.getFingerprint=function(){for(var t=this.row,e=t-16+1,n=new Int32Array(e),r=0;e>r;++r){var i=0;i=i<<2|T(r,4,3,15,1.98215,2.35817,2.63523),i=i<<2|M(r,4,6,15,-1.03809,-.651211,-.282167),i=i<<2|j(r,0,4,16,-.298702,.119262,.558497),i=i<<2|O(r,8,2,12,-.105439,.0153946,.135898),i=i<<2|O(r,4,4,8,-.142891,.0258736,.200632),i=i<<2|M(r,0,3,5,-.826319,-.590612,-.368214),i=i<<2|j(r,2,2,9,-.557409,-.233035,.0534525),i=i<<2|I(r,7,3,4,-.0646826,.00620476,.0784847),i=i<<2|I(r,6,2,16,-.192387,-.029699,.215855),i=i<<2|I(r,1,3,2,-.0397818,-.00568076,.0292026),i=i<<2|P(r,10,1,15,-.53823,-.369934,-.190235),i=i<<2|O(r,6,2,10,-.124877,.0296483,.139239),i=i<<2|I(r,1,1,14,-.101475,.0225617,.231971),i=i<<2|O(r,5,6,4,-.0799915,-.00729616,.063262),i=i<<2|j(r,9,2,12,-.272556,.019424,.302559),i=i<<2|O(r,4,2,14,-.164292,-.0321188,.08463),n[r]=i}return n},r.prototype.compressSubFingerprint=function(t){for(var e=1,n=0;0!==t;)0!==(1&t)&&(k[this.bitsIndex++]=e-n,n=e),t>>>=1,e++;k[this.bitsIndex++]=0},r.prototype.writeExceptionBits=function(t,e){for(var n=this.bitsIndex,r=0,i=0,o=0;n>o;++o){var a=k[o];if(!(7>a))for(a-=7,r|=a<<i,i+=5;i>=8;)t[e++]=255&r,r>>>=8,i-=8}for(;i>0;)t[e++]=255&r,r>>>=8,i-=8;return i=0,e},r.prototype.writeNormalBits=function(t,e){for(var n=this.bitsIndex,r=0,i=0,o=0;n>o;++o){var a=Math.min(k[o],7);for(r|=a<<i,i+=3;i>=8;)t[e++]=255&r,r>>>=8,i-=8}for(;i>0;)t[e++]=255&r,r>>>=8,i-=8;return i=0,e},r.prototype.base64Encode=function(t,e){for(var n=(4*e+2)/3|0,r="",i=0;e>0;)r+=String.fromCharCode(x[t[i]>>2]),r+=String.fromCharCode(x[63&(t[i]<<4|(--e>0?t[i+1]>>4:0))]),e>0&&(r+=String.fromCharCode(x[63&(t[i+1]<<2|(--e>0?t[i+2]>>6:0))]),e>0&&(r+=String.fromCharCode(x[63&t[i+2]]),e--)),i+=3;if(r.length!==n)throw new Error("wrong length");return r},r.prototype.compressed=function(){var t=this.getFingerprint();this.bitsIndex=0;var e=t[0];this.compressSubFingerprint(e);for(var n=1;n<t.length;++n){var r=t[n];this.compressSubFingerprint(r^e),e=r}var i=t.length,o=new Uint8Array(t.buffer);o[0]=1,o[1]=i>>>16&255,o[2]=i>>>8&255,o[3]=i>>>0&255;var a=this.writeNormalBits(o,4);return a=this.writeExceptionBits(o,a),this.base64Encode(o,a)},r.prototype.calculate=function(t){do this.hammingWindow(),i(p),this.chroma();while(this.fill());return this.transformImage(),t?this.getFingerprint():this.compressed()};const L=function(t){t.reverse();for(var e=[],n=0;n<t.length;++n){var r=t[n];if(r&&r.releasegroups){var i=r.releasegroups;if(i)for(var o=0;o<i.length;++o){var a=i[o];if(a){a.type||(a.type="crap");var s=a.secondarytypes;e.push({indexI:n,indexJ:o,recording:r,type:a.type.toLowerCase(),album:i[o],secondarytypes:s?s.map(function(t){return t.toLowerCase()}):null})}}}}return e.sort(function(t,e){if("album"===t.type&&"album"===e.type){var n=t.secondarytypes,r=e.secondarytypes;if(n&&r){var i=n.indexOf("compilation")>=0,o=r.indexOf("compilation")>=0;if(i&&o){var a=t.indexI-e.indexI;return 0!==a?a:t.indexJ-e.indexJ}if(i&&!o)return 1;if(!i&&o)return-1;var a=t.indexI-e.indexI;return 0!==a?a:t.indexJ-e.indexJ}if(n&&!r)return 1;if(!n&&r)return-1;var a=t.indexI-e.indexI;return 0!==a?a:t.indexJ-e.indexJ}return"album"===t.type?-1:1}),e.length?e[0]:{recording:t[0],album:null}},B=function(t){if(1===t.length)return t[0].name;for(var e="",n=0;n<t.length-1;++n)e+=t[n].name+t[n].joinphrase;return e+=t[n].name},D=function(t){if(!t)throw new a("Invalid JSON response",-1);if("error"===t.status)throw new a(t.error.message,t.error.code);var e=t.results&&t.results[0]||null;if(!e)return null;if(!e.recordings||0===e.recordings.length)return null;var n=L(e.recordings);if(!n)return null;var r=n.recording,i={name:r.title,mbid:r.id,type:"release"},o=null;n.album&&(o={name:n.album.title,mbid:n.album.id,type:"release-group"});var s=null;return r.artists&&r.artists.length&&(s={name:B(r.artists),mbid:r.artists[0].id,type:"artist"}),{title:i,album:o,artist:s}};r.fetch=function(t,e){return e||(e=0),new o(function(e,n){function r(){n(new o.TimeoutError("request timed out"))}var i=0|+t.duration,a=t.fingerprint,u=s.queryString({client:"djbbrJFK",format:"json",duration:i,meta:"recordings+releasegroups+compress",fingerprint:a}),l=new XMLHttpRequest;l.timeout=5e3;var c="https://api.acoustId.org/v2/lookup?"+u;l.addEventListener("load",function(){try{var t=JSON.parse(this.responseText);e(t)}catch(r){n(r)}},!1),l.addEventListener("abort",r),l.addEventListener("timeout",r),l.addEventListener("error",r),l.open("GET",c),l.send(null)}).then(D)["catch"](a,function(n){if(n.isRetryable()&&5>=e)return r.fetch(t,e+1);throw n}).tap(function(e){e&&u.updateAcoustId(t.uid,e)})};var U=[],N=!1;const z=function(){if(U.length>0){var t=U.shift();t.resolve(V(t.args))}else N=!1};r.fetchImage=function(t){return new o(function(e){N?U.push({args:t,resolve:e}):(N=!0,e(V(t)))})["finally"](z)};const V=function(t){var e=t.albumKey,n=(t.uid,t.acoustId);return u.getAlbumImage(e).then(function(t){if(t)return t;if(n&&n.album){var r=n.album.type,i=n.album.mbid,o="https://coverartarchive.org/"+r+"/"+i+"/front-250",a={url:o};return u.setAlbumImage(e,o),a}return null})};e.exports=r},{TagDatabase:4,"audio/AcoustIdApiError":6,"lib/bluebird":17,"lib/realfft":21,"lib/util":23}],6:[function(t,e,n){"use strict";const r=t("lib/util"),i=function(t){return Object.keys(o).filter(function(e){var n=o[e];return"number"==typeof n&&t===n})[0]||"ERROR_UNKNOWN"};var o=r.subClassError("AcoustIdApiError",function(t,e){this.code=e,this.message=t||i(e)});o.ERROR_INVALID_RESPONSE_SYNTAX=-1,o.ERROR_UNKNOWN_FORMAT=1,o.ERROR_MISSING_PARAMETER=2,o.ERROR_INVALID_FINGERPRINT=3,o.ERROR_INVALID_APIKEY=4,o.ERROR_INTERNAL=5,o.ERROR_INVALID_USER_APIKEY=6,o.ERROR_INVALID_UUID=7,o.ERROR_INVALID_DURATION=8,o.ERROR_INVALID_BITRATE=9,o.ERROR_INVALID_FOREIGNID=10,o.ERROR_INVALID_MAX_DURATION_DIFF=11,o.ERROR_NOT_ALLOWED=12,o.ERROR_SERVICE_UNAVAILABLE=13,o.ERROR_TOO_MANY_REQUESTS=14,o.ERROR_INVALID_MUSICBRAINZ_ACCESS_TOKEN=15,o.ERROR_INSECURE_REQUEST=14,o.prototype.isFatal=function(){switch(this.code){case o.ERROR_INVALID_RESPONSE_SYNTAX:case o.ERROR_UNKNOWN_FORMAT:case o.ERROR_MISSING_PARAMETER:case o.ERROR_INVALID_FINGERPRINT:case o.ERROR_INVALID_APIKEY:case o.ERROR_INVALID_USER_APIKEY:case o.ERROR_INVALID_UUID:case o.ERROR_INVALID_DURATION:case o.ERROR_INVALID_BITRATE:case o.ERROR_INVALID_FOREIGNID:case o.ERROR_INVALID_MAX_DURATION_DIFF:case o.ERROR_INVALID_MUSICBRAINZ_ACCESS_TOKEN:case o.ERROR_INSECURE_REQUEST:return!0;default:return!1}},o.prototype.isRetryable=function(){return!this.isFatal()},e.exports=o},{"lib/util":23}],7:[function(t,e,n){"use strict";function r(t){this.channels=t}const i=function(t,e,n){if(t===e)return t;for(var r=0;n>r;++r)e[r]=t[r];return e},o=Object.create(null),a=function(t){var e=t+" ",n=o[e];if(n)for(var r=0;r<n.length;++r)n[r]=0;else n=new Float32Array(t),o[e]=n;return n};r.prototype.setChannels=function(t){this.channels=t},r.prototype.getChannels=function(){return this.channels},r.prototype.mix=function(t,e,n){void 0===e&&(e=t[0].length),void 0===n&&(n=t);const r=t.length;if(r===this.channels){for(var o=0;r>o;++o)i(t[o],n[o],e);return n}var a=this.channels;if(1===a){if(2===r)return this._mix2to1(t,e,n);if(4===r)return this._mix4to1(t,e,n);if(6===r)return this._mix6to1(t,e,n)}else if(2===a){if(1===r)return this._mix1to2(t,e,n);if(4===r)return this._mix4to2(t,e,n);if(6===r)return this._mix6to2(t,e,n)}else if(4===a){if(1===r)return this._mix1to4(t,e,n);if(2===r)return this._mix2to4(t,e,n);if(6===r)return this._mix6to4(t,e,n)}else if(6===a){if(1===r)return this._mix1to6(t,e,n);if(2===r)return this._mix2to6(t,e,n);if(4===r)return this._mix4to6(t,e,n)}return this._mixAnyToAny(t,e,n)},r.prototype._mix1to2=function(t){return[t[0],t[0]]},r.prototype._mix1to4=function(t,e,n){var r=a(e);return[t[0],t[0],r,r]},r.prototype._mix1to6=function(t,e,n){var r=a(e);return[r,r,t[0],r,r,r]},r.prototype._mix2to1=function(t,e,n){for(var r=n[0],i=0;e>i;++i)r[i]=Math.fround(Math.fround(t[0][i]+t[1][i])/2);return[r]},r.prototype._mix2to4=function(t,e,n){var r=a(e);return[i(t[0],n[0],e),i(t[1],n[1],e),r,r]},r.prototype._mix2to6=function(t,e,n){var r=a(e);return[i(t[0],n[0],e),i(t[1],n[1],e),r,r,r,r]},r.prototype._mix4to1=function(t,e,n){for(var r=n[0],i=0;e>i;++i)r[i]=(t[0][i]+t[1][i]+t[2][i]+t[3][i])/4;return[r]},r.prototype._mix4to2=function(t,e,n){for(var r=n[0],i=n[1],o=0;e>o;++o)r[o]=(t[0][o]+t[2][o])/2,i[o]=(t[1][o]+t[3][o])/2;return[r,i]},r.prototype._mix4to6=function(t,e,n){var r=a(e);return[i(t[0],n[0],e),i(t[1],n[1],e),r,r,i(t[2],n[2],e),i(t[3],n[3],e)]},r.prototype._mix6to1=function(t,e,n){for(var r=n[0],i=0;e>i;++i){var o=t[0][i],a=t[1][i],s=t[2][i],u=t[4][i],l=t[5][i];r[i]=Math.fround(.7071067811865476*(o+a))+s+Math.fround(.5*(u+l))}return[r]},r.prototype._mix6to2=function(t,e,n){for(var r=n[0],i=n[1],o=0;e>o;++o){var a=t[0][o],s=t[1][o],u=t[2][o],l=t[4][o],c=t[5][o];r[o]=a+Math.fround(.7071067811865476*Math.fround(u+l)),i[o]=s+Math.fround(.7071067811865476*Math.fround(u+c))}return[r,i]},r.prototype._mix6to4=function(t,e,n){for(var r=n[0],i=n[1],o=n[4],a=n[5],s=0;e>s;++s){var u=t[0][s],l=t[1][s],c=t[2][s];r[s]=u+Math.fround(.7071067811865476*c),i[s]=l+Math.fround(.7071067811865476*c)}return[r,i,o,a]},r.prototype._mixAnyToAny=function(t,e,n){var r=this.channels;if(r<t.length){for(var o=0;r>o;++o)i(t[o],n[o],e);return n.slice(0,r)}if(r>t.length){for(var o=0;r>o;++o)i(t[o],n[o],e);for(var s=a(e);o<t.length;++o)n[o]=s;return n}for(var o=0;r>o;++o)i(t[o],n[o],e);return n},e.exports=r},{}],8:[function(t,e,n){"use strict";function r(t,e){this.file=t,this.resolve=e,this.fileView=new s(t)}const i=t("TagDatabase"),o=t("lib/bluebird"),a=t("audio/sniffer"),s=t("lib/FileView"),u=t("metadata/mp3_metadata"),l=8,c=[];var f=0;const h=function(){var t=new Error("codec not supported");return t.name="CodecNotSupportedError",t},p=function(){if(f--,c.length>0){var t=c.shift(),e=new r(t.file,t.resolve);f++,e.parse()}};r.prototype.parse=function(){var t=this,e={basicInfo:{duration:NaN,sampleRate:44100,channels:2}},n=a.getCodecName(this.fileView).then(function(n){if(!n)throw h();switch(n){case"wav":case"webm":case"aac":case"ogg":throw h();case"mp3":return u(e,t.fileView)}})["catch"](function(t){throw h()}).tap(function(){return e});this.resolve(n)},r.parse=function(t){return new o(function(e){if(f>=l)c.push({file:t.file,resolve:e});else{var n=new r(t.file,e);f++,n.parse()}})["finally"](p)},r.fetchAnalysisData=function(t){var e=i.query(t.uid),n=i.getAlbumImage(t.albumKey);return o.join(e,n,function(t,e){return t&&e&&(t.albumImage=e),t})},e.exports=r},{TagDatabase:4,"audio/sniffer":14,"lib/FileView":15,"lib/bluebird":17,"metadata/mp3_metadata":24}],9:[function(t,e,n){"use strict";function r(t){this.base_length=0|t[0],this.oversample=0|t[1],this.downsample_bandwidth=Math.fround(t[2]),this.upsample_bandwidth=Math.fround(t[3]),this.table=t[4]}function i(t,e,n,r){void 0===r&&(r=0),this.id=p++,this.initialised=0,this.started=!1,this.in_rate=0,this.out_rate=0,this.num_rate=0,this.den_rate=0,this.quality=-1,this.sinc_table_length=0,this.mem_alloc_size=0,this.filt_len=0,this.mem=null,this.cutoff=Math.fround(1),this.nb_channels=t,this.in_stride=1,this.out_stride=1,this.buffer_size=160,this.last_sample=new Int32Array(this.nb_channels),this.magic_samples=new Uint32Array(this.nb_channels),this.samp_frac_num=new Uint32Array(this.nb_channels),this.int_advance=0,this.frac_advance=0,this.oversample=0,this.sinc_table=null,this.sinc_table_length=0,this.setQuality(r),this.setRateFrac(e,n,e,n),this._updateFilter(),this.initialised=1}const o=new Float64Array([.99859849,1,.99859849,.99440475,.98745105,.97779076,.9654977,.95066529,.93340547,.91384741,.89213598,.86843014,.84290116,.81573067,.78710866,.75723148,.7262997,.69451601,.66208321,.62920216,.59606986,.56287762,.52980938,.49704014,.46473455,.43304576,.40211431,.37206735,.343018,.3150649,.28829195,.26276832,.23854851,.21567274,.19416736,.17404546,.15530766,.13794294,.12192957,.10723616,.09382272,.08164178,.0706395,.06075685,.05193064,.04409466,.03718069,.03111947,.02584161,.02127838,.0173625,.01402878,.01121463,.00886058,.00691064,.00531256,.00401805,.00298291,.00216702,.00153438,.00105297,69463e-8,43489e-8,25272e-8,13031e-8,527734e-10,1e-5,0]),a=new Float64Array([.99537781,1,.99537781,.98162644,.95908712,.92831446,.89005583,.84522401,.79486424,.74011713,.68217934,.62226347,.56155915,.5011968,.44221549,.38553619,.33194107,.28205962,.23636152,.19515633,.15859932,.1267028,.09935205,.07632451,.05731132,.0419398,.02979584,.0204451,.01345224,.00839739,.00488951,.00257636,.00115101,35515e-8,0,0]),s=new Float64Array([.99635258,1,.99635258,.98548012,.96759014,.943022,.91223751,.87580811,.83439927,.78875245,.73966538,.68797126,.6345175,.58014482,.52566725,.47185369,.4194115,.36897272,.32108304,.27619388,.23465776,.1967267,.1625538,.13219758,.10562887,.08273982,.06335451,.04724088,.03412321,.0236949,.01563093,.00959968,.00527363,.00233883,5e-4,0]),u=new Float64Array([.99733006,1,.99733006,.98935595,.97618418,.95799003,.93501423,.90755855,.87598009,.84068475,.80211977,.76076565,.71712752,.67172623,.62508937,.57774224,.53019925,.48295561,.43647969,.39120616,.34752997,.30580127,.26632152,.22934058,.19505503,.16360756,.13508755,.10953262,.0869312,.067226,.0503182,.03607231,.02432151,.01487334,.00752,0]),l=(new Float64Array(4),[[8,4,.83,.86,u],[16,4,.85,.88,u],[32,4,.882,.91,u],[48,8,.895,.917,s],[64,8,.921,.94,s],[80,16,.922,.94,a],[96,16,.94,.945,a],[128,16,.95,.95,a],[160,16,.96,.96,a],[192,32,.968,.968,o],[256,32,.975,.975,o]].map(function(t){return new r(t)})),c=new Float64Array(4),f=function(t,e){var n=t*(e.length-4),r=0|Math.floor(n),i=n-r;return c[3]=-.1666666667*i+.1666666667*(i*i*i),c[2]=i+.5*(i*i)-.5*(i*i*i),c[0]=-.3333333333*i+.5*(i*i)-.1666666667*(i*i*i),c[1]=1-c[3]-c[2]-c[0],c[0]*e[r]+c[1]*e[r+1]+c[2]*e[r+2]+c[3]*e[r+3]},h=function(t,e,n,r){var i=Math.fround(Math.abs(e));if(1e-6>i)return t;if(i>.5*n)return 0;var o=Math.fround(e*t);return t*Math.sin(Math.PI*o)/(Math.PI*o)*f(Math.fround(Math.abs(2*e/n)),r)};var p=0;i.prototype.setQuality=function(t){if(t=0|t,t>10||0>t||!isFinite(t))throw new Error("bad quality value");this.quality!==t&&(this.quality=t,this.initialised&&this._updateFilter())},i.prototype.setRateFrac=function(t,e,n,r){if(arguments.length<=2&&(n=t,r=e),n=0|n,r=0|r,t=0|t,e=0|e,0>=n||0>=r||0>=t||0>=e)throw new Error("invalid params");var i,o,a;if(this.in_rate!==n||this.out_rate!==r||this.num_rate!==t||this.den_rate!==e){for(o=this.den_rate,this.in_rate=n,this.out_rate=r,this.num_rate=t,this.den_rate=e,i=2;i<=Math.min(this.num_rate,this.den_rate);i++)for(;this.num_rate%i===0&&this.den_rate%i===0;)this.num_rate/=i,this.den_rate/=i;if(o>0)for(a=0;a<this.nb_channels;a++)this.samp_frac_num[a]=this.samp_frac_num[a]*this.den_rate/o,this.samp_frac_num[a]>=this.den_rate&&(this.samp_frac_num[a]=this.den_rate-1);this.initialised&&this._updateFilter()}},i.prototype._updateFilter=function(){var t,e,n=this.filt_len,r=this.mem_alloc_size;if(this.int_advance=this.num_rate/this.den_rate|0,this.frac_advance=this.num_rate%this.den_rate|0,this.oversample=l[this.quality].oversample,this.filt_len=l[this.quality].base_length,this.num_rate>this.den_rate?(this.cutoff=Math.fround(l[this.quality].downsample_bandwidth*this.den_rate/this.num_rate),this.filt_len=this.filt_len*this.num_rate/this.den_rate>>>0,this.filt_len=(this.filt_len-1&-8)+8>>>0,2*this.den_rate<this.num_rate&&(this.oversample>>=1),4*this.den_rate<this.num_rate&&(this.oversample>>=1),8*this.den_rate<this.num_rate&&(this.oversample>>=1),16*this.den_rate<this.num_rate&&(this.oversample>>=1),this.oversample<1&&(this.oversample=1)):this.cutoff=l[this.quality].upsample_bandwidth,536870911.75/this.den_rate<this.filt_len)throw new Error("INT_MAX/sizeof(spx_word16_t)/this.den_rate < this.filt_len");var t=this.filt_len*this.den_rate;this.sinc_table_length<t&&(this.sinc_table=new Float32Array(t),this.sinc_table_length=t);for(var i=l[this.quality].table,o=0;o<this.den_rate;++o)for(var a=0;a<this.filt_len;++a){var s=o*this.filt_len+a,u=Math.fround(a-(this.filt_len/2|0)+1)-Math.fround(o/this.den_rate);this.sinc_table[s]=h(this.cutoff,u,this.filt_len,i)}if(e=this.filt_len-1+this.buffer_size,e>this.mem_alloc_size){if(536870911.75/this.nb_channels<e)throw new Error("INT_MAX/sizeof(spx_word16_t)/this.nb_channels < min_alloc_size");this.mem=new Float32Array(this.nb_channels*e),this.mem_alloc_size=e}if(this.initialised)if(this.filt_len>n)for(var o=this.nb_channels;0!==o--;){var a,c=n;if(0!==this.magic_samples[o]){for(c=n+2*this.magic_samples[o],a=n-1+this.magic_samples[o];0!==a--;)this.mem[o*this.mem_alloc_size+a+this.magic_samples[o]]=this.mem[o*r+a];for(a=0;a<this.magic_samples[o];a++)this.mem[o*this.mem_alloc_size+a]=0;this.magic_samples[o]=0}if(this.filt_len>c){for(a=0;c-1>a;a++)this.mem[o*this.mem_alloc_size+(this.filt_len-2-a)]=this.mem[o*this.mem_alloc_size+(c-2-a)];for(;a<this.filt_len-1;a++)this.mem[o*this.mem_alloc_size+(this.filt_len-2-a)]=0;this.last_sample[o]+=(this.filt_len-c)/2|0}else for(this.magic_samples[o]=(c-this.filt_len)/2|0,a=0;a<this.filt_len-1+this.magic_samples[o];a++)this.mem[o*this.mem_alloc_size+a]=this.mem[o*this.mem_alloc_size+a+this.magic_samples[o]]}else if(this.filt_len<n)for(var o=0;o<this.nb_channels;o++){var f=this.magic_samples[o];this.magic_samples[o]=(n-this.filt_len)/2|0;for(var a=0;a<this.filt_len-1+this.magic_samples[o]+f;a++)this.mem[o*this.mem_alloc_size+a]=this.mem[o*this.mem_alloc_size+a+this.magic_samples[o]];this.magic_samples[o]+=f}};const d=1048576,_=new Array(6),v=function(t,e){return void 0===_[t]&&(_[t]=new ArrayBuffer(d)),new Float32Array(_[t],0,e)};i.prototype.end=function(){if(!this.started)throw new Error("not started");this.started=!1;for(var t=0;t<this.nb_channels;++t)this.last_sample[t]=0,this.magic_samples[t]=0,this.samp_frac_num[t]=0;if(this.mem)for(var t=0;t<this.mem.length;++t)this.mem[t]=0},i.prototype.start=function(){if(this.started)throw new Error("already started");this.started=!0},i.prototype.getLength=function(t){return 0|Math.ceil(t*this.den_rate/this.num_rate)},i.prototype.resample=function(t,e,n){if(t.length!==this.nb_channels)throw new Error("input doesn't have expected channel count");if(!this.started)throw new Error("start() not called");void 0==e&&(e=t[0].length);const r=this.getLength(e);if(void 0==n){n=new Array(t.length);for(var i=0;i<t.length;++i)n[i]=v(i,r)}for(var i=0;i<t.length;++i)this._processFloat(i,t[i],e,n[i]);return n};const m={out_ptr:0,out_len:0,in_len:0,in_ptr:0,out_values:null};i.prototype._processFloat=function(t,e,n,r){var i=0,o=0,a=n,s=r.length,u=t*this.mem_alloc_size;const l=this.filt_len-1,c=this.mem_alloc_size-l,f=this.in_stride,h=this.mem;if(m.out_values=r,m.out_ptr=o,0!==this.magic_samples[t]&&(s-=this._resamplerMagic(t,s)),o=m.out_ptr,0===this.magic_samples[t])for(;a>0&&s>0;){for(var p=a>c?c:a,d=s,_=0;p>_;++_)h[u+_+l]=e[i+_*f];m.in_len=p,m.out_ptr=o,m.out_len=d,this._processNative(t),p=m.in_len,d=m.out_len,a-=p,s-=d,o+=d*this.out_stride,i+=p*f}},i.prototype._processNative=function(t){const e=this.filt_len,n=t*this.mem_alloc_size,r=this.mem;var i=this._resamplerBasicDirectSingle(t),o=m.in_len,a=m.out_len;this.last_sample[t]<o&&(o=this.last_sample[t],m.in_len=o),a=i,m.out_len=a,this.last_sample[t]-=o;const s=o;for(var u=0;e-1>u;++u)r[n+u]=r[n+u+s]},i.prototype._resamplerMagic=function(t,e){var n=this.magic_samples[t],r=this.mem_alloc_size+t;const i=this.filt_len;m.out_len=e,m.in_len=n,this._processNative(t),e=m.out_len,n=m.in_len,this.magic_samples[t]-=n;const o=this.magic_samples[t];if(0!==o)for(var a=this.mem,s=0;o>s;++s)a[r+i-1+s]=a[r+i-1+s+n];return m.out_ptr=m.out_ptr+e*this.out_stride,e},i.prototype._resamplerBasicDirectSingle=function(t){const e=this.filt_len;var n=0,r=this.last_sample[t],i=this.samp_frac_num[t];const o=this.sinc_table,a=this.out_stride,s=this.int_advance,u=this.frac_advance,l=this.den_rate,c=t*this.mem_alloc_size,f=this.mem;var h=m.in_len,p=m.out_len;for(const d=m.out_ptr,_=m.out_values;!(r>=h||n>=p);){for(var v=i*e,y=m.in_ptr+r,g=Math.fround(0),b=Math.fround(0),w=Math.fround(0),E=Math.fround(0),C=0;e>C;C+=4)g+=Math.fround(o[v+C]*f[c+y+C]),b+=Math.fround(o[v+C+1]*f[c+y+C+1]),w+=Math.fround(o[v+C+2]*f[c+y+C+2]),E+=Math.fround(o[v+C+3]*f[c+y+C+3]);_[d+Math.imul(a,n++)]=Math.fround(g+Math.fround(b+Math.fround(w+E))),r+=s,i+=u,i>=l&&(i-=l,r++)}return this.last_sample[t]=r,this.samp_frac_num[t]=i,n},e.exports=i},{}],10:[function(t,e,n){"use strict";function r(){function t(){e&&(F(v,e),e=null),n&&(S(n),n=null),u&&(k(T*h,_,u),u=null),c&&(k(1323e3,1,c),c=null),r()}if(U=-1,D=!1,B=!0,0===L.length)return void(B=!1);var e,n,u,c,h,_,v,w=L.shift(),M=w.id,N=w.file,z=w.fingerprint,V=w.loudness;U=M;var H=new m(N);b.getCodecName(H).then(function(t){return t?g.getCodec(t):void a(M,new Error("file type not supported"))}).then(function(t){return t?y(t.name,H).then(function(r){if(!r)return void a(M,new Error("file type not supported"));var m={loudness:null,fingerprint:null,duration:r.duration},y=!1;if(y=r.duration?r.duration>1800:N.size>104857600)return s(M,m);v=t.name,e=R(t.name,t.Context,{seekable:!1,dataType:t.Context.FLOAT,targetBufferLengthSeconds:T}),h=r.sampleRate,_=r.channels;var g=0,b=h*O,k=0;z=z&&r.duration>=7;var S;z&&(u=A(T*h,_),c=A(1323e3,1),h!==I&&(n=x(1,h,I,j))),V&&(S=new C(_,h,C.EBUR128_MODE_I|C.EBUR128_MODE_SAMPLE_PEAK)),e.start(r);var F=!1;
e.on("data",function(t){F=!0;var e=t[0].length;if(g+=e,z=z&&b>=g){for(var r=0;r<t.length;++r)for(var i=t[r],o=u[r],a=0;a<i.length;++a)o[a]=i[a];var s=P.mix(u,e),l=e;n&&(s=n.resample([s[0]],e),l=s[0].length);for(var i=s[0],o=c[0],a=0;l>a;++a)o[a+k]=i[a];k+=l}V&&S&&S.add_frames(t,e)});var L=r.dataStart,B=!1,U=Date.now();return H.readBlockOfSizeAt(r.maxByteSizePerSample*h*T,L,2).then(function q(){F=!1;var t=H.block(),n=Date.now(),a=H.toBufferOffset(L),s=e.decodeUntilFlush(t,a),u=l(Date.now()-n),c=s-a;L+=c;var p=(L-r.dataStart)/(r.dataEnd-r.dataStart);if(p>.15&&U>0){var d=Date.now()-U,_=Math.round(d/p-d);U=-1,o(M,_)}if(!F&&r.dataEnd-L<=r.maxByteSizePerSample*r.samplesPerFrame*10)return f.delay(u);if(D)return B=!0,i(M),f.delay(u);var v=Date.now();return H.readBlockOfSizeAt(r.maxByteSizePerSample*h*T,L,2).then(function(){var t=Math.max(0,u-(Date.now()-v));return f.delay(t).then(q)})}).then(function(){if(!B){if(c&&k>0){var t=new E(c[0],k);m.fingerprint={fingerprint:t.calculate(!1)}}if(V&&S){var e=C.REFERENCE_LUFS-S.loudness_global(),n=Math.max.apply(Math,S.getSamplePeak()),r=S.getSilence();m.loudness={trackGain:e,trackPeak:n,silence:r}}var i=p.assign({duration:m.duration},m.loudness||{},m.fingerprint||{});return d.insert(w.uid,i)["catch"](function(t){}).then(function(){s(M,i)})}})}):void 0})["catch"](function(t){a(M,t)}).then(t,t)}function i(t){self.postMessage({id:t,type:"abort",jobType:"analyze"})}function o(t,e){self.postMessage({id:t,type:"estimate",value:e,jobType:"analyze"})}function a(t,e){self.postMessage({id:t,type:"error",jobType:"analyze",error:{message:e.message,stack:e.stack}})}function s(t,e){self.postMessage({id:t,type:"success",jobType:"analyze",result:e})}self.EventEmitter=t("lib/events"),t("lib/text_codec");const u=.2,l=function(t){return t/u-t},c=t("lib/patchtimers"),f=t("lib/bluebird");f.setScheduler(function(t){t()}),f.config({cancellation:!1,warnings:!1,longStackTraces:!1});const h=t("lib/blobpatch");h();const p=t("lib/util"),d=t("TagDatabase"),_=t("audio/MetadataParser"),v=(t("audio/Resampler"),t("audio/ChannelMixer")),m=t("lib/FileView"),y=t("audio/demuxer"),g=t("audio/codec"),b=t("audio/sniffer"),w=t("pool"),E=t("audio/AcoustId"),C=t("audio/ebur128"),A=w.allocBuffer,k=w.freeBuffer,x=w.allocResampler,R=w.allocDecoderContext,S=w.freeResampler,F=w.freeDecoderContext,T=30,j=0,I=11025,O=120,M=1,P=new v(M);var L=[],B=!1,D=!1,U=-1;const N=function(t,e,n){return e.then(function(e){return postMessage({id:t.id,result:e,jobType:n,type:"success"}),e})["catch"](function(e){postMessage({id:t.id,type:"error",jobType:n,error:{message:e.message,stack:e.stack}})})},z={analyze:function(t){L.push(t),B||r()},abort:function(t){var e=t.id;U===e&&(D=!0)},parseMetadata:function(t){N(t,_.parse(t),"metadata")},fetchAnalysisData:function(t){N(t,_.fetchAnalysisData(t),"analysisData")},fetchAcoustId:function(t){N(t,E.fetch(t),"acoustId")},fetchAcoustIdImage:function(t){N(t,E.fetchImage(t),"acoustIdImage")},rateTrack:function(t){d.updateRating(t.uid,t.rating)},tick:c};self.onmessage=function(t){var e=t.data,n=z[e.action];if("function"!=typeof n)throw new Error("unknown api action: "+e.action);n(e.args)},g.getCodec("mp3").then(function(){self.postMessage({type:"ready"})})},{TagDatabase:4,"audio/AcoustId":5,"audio/ChannelMixer":7,"audio/MetadataParser":8,"audio/Resampler":9,"audio/codec":11,"audio/demuxer":12,"audio/ebur128":13,"audio/sniffer":14,"lib/FileView":15,"lib/blobpatch":16,"lib/bluebird":17,"lib/events":18,"lib/patchtimers":20,"lib/text_codec":22,"lib/util":23,pool:25}],11:[function(t,e,n){(function(t){"use strict";const n="undefined"!=typeof self?self:t,r=Object.create(null),i=function(t){return new Promise(function(e){setTimeout(e,t)})};var o=null;const a=function(t,e){return r[t]?r[t]:(void 0===e&&(e=0),r[t]=new Promise(function(r,s){var u=n.DEBUGGING===!1?"dist/worker/codecs/"+t+".min.js":"dist/worker/codecs/"+t+".js",l=new XMLHttpRequest;l.addEventListener("load",function(){if(l.status>=300)return l.status>=500&&5>e?r(i(1e3).then(function(){return a(t,e+1)})):s(new Error("http error when loading codec: "+l.status+" "+l.statusText));var n=l.responseText;o=null;try{new Function(n)(),o&&o.name===t||s(new Error("codec "+t+" did not register properly")),r(o)}finally{o=null}},!1),l.addEventListener("error",function(){s(new Error("error when loading codec"))},!1),l.open("GET",u),l.send(null)}),r[t])};n.codecLoaded=function(t,e){o={name:t,Context:e}};var s={};s.getCodec=function(t){return a(t)},e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(t,e,n){"use strict";function r(t){return!(-2097152!==(4292870144&t)||(t&3<<17)!==1<<17||61440===(61440&t)||3072===(3072&t))}function i(t,e){var n=Math.min(t+4096,e.end),r=e.getInt32(t+4,!0),i=t+r+8,o=e.getInt32(t+16,!0),a=(e.getInt16(t+20,!0),e.getInt16(t+22,!0)),s=e.getInt32(t+24,!0),l=32e3>s,c=l?576:1152,f=e.getInt32(t+28,!0),h=(e.getInt16(t+32,!0),e.getInt16(t+34,!0),e.getInt16(t+36,!0),e.getInt16(t+38,!0),e.getInt32(t+40,!0),e.getInt16(t+44,!0)),p=(e.getInt16(t+46,!0),e.getInt16(t+48,!0)),d=0;t+=o+16+4;for(var _=0;n>t;){var v=e.getInt32(t,!1);if(t+=4,v===b){var m=e.getInt32(t,!0);t+=4;var y=e.getInt32(t,!0);_=y/s,d=y/c|0,t+=m}else{if(v===g){var w=t+4;if(0===_&&(_=Math.max(0,i-w)/f,d=_*s/c|0),u>_)return null;var E={frames:d,encoderDelay:p,encoderPadding:0,paddingStartFrame:-1,lsf:l,sampleRate:s,channels:a,bitRate:8*f,dataStart:w,dataEnd:i,averageFrameSize:h,vbr:!1,duration:_,samplesPerFrame:c,maxByteSizePerSample:Math.ceil((4608e4/(s<<l)|0)+1)/c,seekTable:null,toc:null};return E}t+=2}}return null}function o(t,e,n){var o=0,s=0,g=t.file.size,b=1152;return void 0===n&&(n=w),t.readBlockOfSizeAt(65536,0).then(function(){if(t.end<65536)return null;if(t.getUint32(0,!1)>>>8===d){var w=10*(t.getUint8(5)>>4&1),C=t.getUint8(6)<<21|t.getUint8(7)<<14|t.getUint8(8)<<7|t.getUint8(9);o=C+10+w,s=o}return t.readBlockOfSizeAt(E,o,4).then(function(){if(t.getInt32(s,!1)===h&&t.getInt32(s+8,!1)===p)return i(s,t);var d=Math.min(g,n),w=null,C=0;return t.readBlockOfSizeAt(E,o,4).then(function A(){var e=o,n=Math.max(0,Math.min(d-o,8192));if(0!==n){for(var i=0;n>i;++i){var s=e+i,u=t.getInt32(s);if(r(u)){if(C>4)return;var h,p;0!==(u&1<<20)?(h=0!==(u&1<<19)?0:1,p=0):(h=1,p=1),b=1===h?576:1152;var k=u>>10&3;if(0>k||k>=c.length)continue;var x=c[u>>10&3]>>h+p,R=15*h+(u>>12&15);if(0>R||R>=f.length)continue;var S=1e3*f[R];if(!S||!x)continue;var F=u>>9&1,T=(S/1e3*144e3/(x<<h)|0)+F,j=t.getInt32(s+4+T-4,!1);if(!r(j)){if(t.getInt32(s+4+32)!==_)continue;i+=35}C++,w?(w.bitRate!==S&&(w.bitRate=S,w.vbr=!0),i+=T-4-1):w={frames:0,encoderDelay:576,encoderPadding:0,paddingStartFrame:-1,lsf:!!h,sampleRate:x,channels:3===(u>>6&3)?1:2,bitRate:S,dataStart:s,dataEnd:g,averageFrameSize:S/1e3*144e3/(x<<h),vbr:!1,duration:0,samplesPerFrame:b,maxByteSizePerSample:Math.ceil((4608e4/(x<<h)|0)+1)/b,seekTable:null,toc:null},u=0}else{if(u===_){w.vbr=!0,e=s+4+10;var I=t.getUint32(e,!1);w.frames=I,w.duration=I*b/w.sampleRate,e+=4;var O=t.getUint16(e,!1);e+=2;var M=t.getUint16(e,!1);e+=2;var P=t.getUint16(e,!1);e+=2;var L=t.getUint16(e,!1);e+=2;var B=e+O+P,D=B,U=new a,N=U.table;N.length=O+1,U.isFromMetaData=!0,U.framesPerEntry=L,U.tocFilledUntil=w.duration,U.frames=I,w.seekTable=U;var z,V=0;switch(P){case 4:z=t.getUint32;break;case 3:z=t.getUint32,V=8;break;case 2:z=t.getUint16;break;case 1:z=t.getUint8;break;default:return null}var H=0;for(N[0]=D;O>H;++H){var q=z.call(t,e+H*P)>>>V;B+=q*M,N[H+1]=B}return w.encoderDelay=1159,void(w.dataStart=D)}if(u===v||u===m){u===v&&(w.vbr=!0),e=s+4;var G=t.getUint32(e,!1);e+=4;var I=-1;if(0!==(7&G)){if(0!==(1&G)){var I=t.getUint32(e,!1);w.frames=I,w.duration=I*b/w.sampleRate,e+=4}if(0!==(2&G)&&(e+=4),0!==(4&G)){for(var Q=new Uint8Array(100),H=0;100>H;++H)Q[H]=t.getUint8(e+H);w.toc=Q,e+=100}G&!0&&(e+=4)}if(t.getInt32(e,!1)===y){e+=21;var F=t.getInt32(e,!1)>>>8,$=F>>12;w.encoderDelay=$;var K=4095&F;-1!==I&&K>0&&(K=Math.max(0,K-l),w.paddingStartFrame=I-Math.ceil(K/w.samplesPerFrame)-1,w.encoderPadding=K),e+=15}return void(w.dataStart=e)}}}return e+=i,o=e,t.readBlockOfSizeAt(E,e,4).then(A)}}).then(function(){if(!w)return null;if(0===w.duration){var n=Math.max(0,w.dataEnd-w.dataStart);w.vbr?e||(w.seekTable=new a,w.seekTable.fillUntil(1800,w,t),w.frames=w.seekTable.frames,w.duration=w.frames*w.samplesPerFrame/w.sampleRate):(w.duration=8*n/w.bitRate,w.frames=w.sampleRate*w.duration/w.samplesPerFrame|0)}return w.duration<u?null:w})})})}function a(){this.frames=0,this.tocFilledUntil=0,this.table=new Array(128),this.lastFrameSize=0,this.framesPerEntry=1,this.isFromMetaData=!1}const s=t("lib/bluebird"),u=(t("lib/FileView"),3),l=529,c=new Uint16Array([44100,48e3,32e3]),f=new Uint16Array([0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,0,8,16,24,32,40,48,56,64,80,96,112,128,144,160]),h=1380533830,p=1463899717,d=4801587,_=1447187017,v=1483304551,m=1231971951,y=1279348037,g=1684108385,b=1717658484,w=5242880,E=16384;e.exports=function(t,e,n,r){try{if("mp3"===t)return o(e,n,r)}catch(i){throw i}return null},a.prototype.closestFrameOf=function(t){return t=Math.min(this.frames,t),Math.round(t/this.framesPerEntry)*this.framesPerEntry},a.prototype.offsetOfFrame=function(t){t=this.closestFrameOf(t);var e=t/this.framesPerEntry;return this.table[e]},a.prototype.fillUntil=s.method(function(t,e,n){if(!(this.tocFilledUntil>=t)){var i,o,i=e.dataStart,a=e.dataEnd,s=(e.maxByteSizePerSample*e.samplesPerFrame|0,Math.ceil(t*(e.sampleRate/(1152>>e.lsf)))),u=(e.lsf?1:0,this.table);this.frames>0?(o=this.frames,i=u[this.frames-1]+this.lastFrameSize):(o=0,i=e.dataStart);var l=this,h=0;return n.readBlockOfSizeAt(E,i,10).then(function p(){for(var t=Math.min(a,i+8192),e=n.block();t>i&&s>o;){var d=i-n.start;if(h=h<<8|e[d]|0,r(h)){var _,v;0!==(h&1<<20)?(_=0!==(h&1<<19)?0:1,v=0):(_=1,v=1);var m=h>>10&3;if(0>m||m>=c.length)i++;else{var y=c[h>>10&3]>>_+v,g=15*_+(h>>12&15);if(0>g||g>=f.length)i++;else{var b=1e3*f[g];u[o]=i-3,o++;var w=h>>9&1,C=(b/1e3*144e3/(y<<_)|0)+w;if(l.lastFrameSize=C,i+=C-4,o>=s)return}}}else i++}return t>=n.file.size?void 0:n.readBlockOfSizeAt(E,i,10).then(p)}).then(function(){l.frames=o,l.tocFilledUntil=e.samplesPerFrame/e.sampleRate*o})}}),e.exports.Mp3SeekTable=a},{"lib/FileView":15,"lib/bluebird":17}],13:[function(t,e,n){"use strict";function r(t){return 10*(Math.log(t)*Math.LOG10E)-.691}function i(t){var e,n=0,r=1e3;do e=(n+r)/2>>0,t>=S[e]?n=e:r=e;while(r-n!=1);return n}function o(t,e){var n=t+" "+e;if(T[n]){for(var r=T[n],i=0;i<r.length;++i)r[i]=0;return r}var r=new Float32Array(t);return T[n]=r,r}function a(t,e,n){if(this.mode=n,this.samplerate=e,this.channels=Math.max(1,Math.min(t,5)),this.channel_map=[],this.initChannels(),this.sample_peak=new Float32Array(t),this.true_peak=new Float32Array(t),this.use_histogram=(n&k)>0,this.samples_in_100ms=(e+5)/10>>>0,this.needed_frames=4*this.samples_in_100ms,this.audio_data_index=0,this.audio_data_frames=0,(n&b)==b)this.audio_data_frames=30*this.samples_in_100ms;else{if((n&g)!=g)throw new Error("invalid mode");this.audio_data_frames=4*this.samples_in_100ms}this.audio_data=new Array(t);for(var r=0;t>r;++r)this.audio_data[r]=o(this.audio_data_frames,r);this.a=new Float32Array(5),this.b=new Float32Array(5),this.filterState=new Array(t),this.filterStateInt32=new Array(t);for(var i=0;t>i;++i)this.filterState[i]=new Float32Array(5),this.filterStateInt32[i]=new Int32Array(this.filterState[i].buffer);this.initFilter(),this.interpolatorState=new Array(t);for(var i=0;t>i;++i)this.interpolatorState[i]=o(this.needed_frames+f-1,i);this.block_energy_histogram=null,this.short_term_block_energy_histogram=null,this.use_histogram&&(this.block_energy_histogram=new Uint32Array(1e3),this.short_term_block_energy_histogram=new Uint32Array(1e3)),this.block_list=[],this.short_term_block_list=[],this.short_term_frame_counter=0,this.short_term_frame_counter=0,this.lastSilenceStarted=-1,this.currentTime=0,this.beginSilenceLength=0,this.endSilenceLength=0}function s(t){this.use_histogram=!1,this.mode=u.int32BE(t,16),this.channels=u.int32BE(t,20)>>>0,this.samplerate=u.int32BE(t,24),this.true_peak=u.float32BE(t,28),this.sample_peak=u.float32BE(t,32),this.block_list=new Array(u.int32BE(t,36)>>>0);for(var e=0;e<this.block_list.length;++e)this.block_list[e]=u.float32BE(t,40+4*e)}const u=t("lib/util"),l=-63,c=-18,f=12,h=0,p=1,d=2,_=3,v=4,m=5,y=6,g=1,b=3,w=5,E=11,C=17,A=49,k=64,x=Math.pow(10,-1),R=(Math.pow(10,-2),new Float32Array(1e3)),S=new Float32Array(1001);S[0]=Math.pow(10,-69.309/10);for(var F=1;1001>F;++F)S[F]=Math.pow(10,(F/10-70+.691)/10);for(var F=0;1e3>F;++F)R[F]=Math.pow(10,(F/10-69.95+.691)/10);const T=Object.create(null);a.prototype.initFilter=function(){var t=this.samplerate,e=1681.974450955533,n=3.999843853973347,r=.7071752369554196,i=Math.tan(Math.PI*e/t),o=Math.pow(10,n/20),a=Math.pow(o,.4996667741545416),s=new Float32Array([0,0,0]),u=new Float32Array([1,0,0]),l=new Float32Array([1,-2,1]),c=new Float32Array([1,0,0]),f=1+i/r+i*i;s[0]=(o+a*i/r+i*i)/f,s[1]=2*(i*i-o)/f,s[2]=(o-a*i/r+i*i)/f,u[1]=2*(i*i-1)/f,u[2]=(1-i/r+i*i)/f,e=38.13547087602444,r=.5003270373238773,i=Math.tan(Math.PI*e/t),c[1]=2*(i*i-1)/(1+i/r+i*i),c[2]=(1-i/r+i*i)/(1+i/r+i*i),this.b[0]=s[0]*l[0],this.b[1]=s[0]*l[1]+s[1]*l[0],this.b[2]=s[0]*l[2]+s[1]*l[1]+s[2]*l[0],this.b[3]=s[1]*l[2]+s[2]*l[1],this.b[4]=s[2]*l[2],this.a[0]=u[0]*c[0],this.a[1]=u[0]*c[1]+u[1]*c[0],this.a[2]=u[0]*c[2]+u[1]*c[1]+u[2]*c[0],this.a[3]=u[1]*c[2]+u[2]*c[1],this.a[4]=u[2]*c[2]},a.EBUR128_MODE_M=g,a.EBUR128_MODE_S=b,a.EBUR128_MODE_I=w,a.EBUR128_MODE_LRA=E,a.EBUR128_MODE_SAMPLE_PEAK=C,a.EBUR128_MODE_TRUE_PEAK=A,a.EBUR128_MODE_HISTOGRAM=k,a.REFERENCE_LUFS=c,a.prototype.initChannels=function(){var t=this.channels;if(4===t)this.channel_map[0]=p,this.channel_map[1]=d,this.channel_map[2]=v,this.channel_map[3]=m;else if(5===t)this.channel_map[0]=p,this.channel_map[1]=d,this.channel_map[2]=_,this.channel_map[3]=v,this.channel_map[4]=m;else for(F=0;t>F;++F)switch(F){case 0:this.channel_map[F]=p;break;case 1:this.channel_map[F]=d;break;case 2:this.channel_map[F]=_;break;case 3:this.channel_map[F]=h;break;case 4:this.channel_map[F]=v;break;case 5:this.channel_map[F]=m;break;default:this.channel_map[F]=h}},a.prototype.updateSamplePeak=function(t,e,n){for(var r=0;r<this.channels;++r){for(var i=-(1/0),o=t[r],a=0;n>a;++a)i=Math.max(i,Math.abs(o[a+e]));this.sample_peak[r]=Math.max(this.sample_peak[r],i)}};var j=new Float32Array([.001708984375,-.0291748046875,-.0189208984375,-.00830078125,.010986328125,.029296875,.0330810546875,.014892578125,-.0196533203125,-.0517578125,-.0582275390625,-.026611328125,.033203125,.089111328125,.1015625,.047607421875,-.0594482421875,-.16650390625,-.2003173828125,-.102294921875,.1373291015625,.465087890625,.77978515625,.97216796875,.97216796875,.77978515625,.465087890625,.1373291015625,-.102294921875,-.2003173828125,-.16650390625,-.0594482421875,.047607421875,.1015625,.089111328125,.033203125,-.026611328125,-.0582275390625,-.0517578125,-.0196533203125,.014892578125,.0330810546875,.029296875,.010986328125,-.00830078125,-.0189208984375,-.0291748046875,.001708984375]);a.prototype.updateTruePeak=function(t,e,n){var r=this.samplerate<96e3?4:this.samplerate<192e3?2:1;if(1!==r)for(var i=j,o=0;o<this.channels;++o){for(var a=-(1/0),s=t[o],u=this.interpolatorState[o],l=0;n>l;++l){u[l+f-1]=s[e+l];for(var c=r-1;c>=0;--c){var h=u[l]*i[c]+u[l+1]*i[c+4]+u[l+2]*i[c+8]+u[l+3]*i[c+12]+u[l+4]*i[c+16]+u[l+5]*i[c+20]+u[l+6]*i[c+24]+u[l+7]*i[c+28]+u[l+8]*i[c+32]+u[l+9]*i[c+36]+u[l+10]*i[c+40]+u[l+11]*i[c+44];a=Math.max(a,Math.abs(h))}}for(var l=n-f-1;n>l;++l)u[l-(n-f-1)]=u[l+f-1];this.true_peak[o]=Math.max(this.true_peak[o],a)}else for(var o=0;o<this.channels;++o)this.true_peak[o]=this.sample_peak[o]},a.prototype.updateAudioData=function(t,e,n){for(var r=this.audio_data_index,i=this.a,o=this.b,a=0;a<this.channels;++a){for(var s=this.filterState[a],u=t[a],l=this.audio_data[a],c=0;n>c;++c)s[0]=u[c+e]-i[1]*s[1]-i[2]*s[2]-i[3]*s[3]-i[4]*s[4],l[c+r]=o[0]*s[0]+o[1]*s[1]+o[2]*s[2]+o[3]*s[3]+o[4]*s[4],s[4]=s[3],s[3]=s[2],s[2]=s[1],s[1]=s[0];var f=this.filterStateInt32[a];0===(2139095040&f[4])&&(s[4]=0),0===(2139095040&f[3])&&(s[3]=0),0===(2139095040&f[2])&&(s[2]=0),0===(2139095040&f[1])&&(s[1]=0)}},a.prototype.filter=function(t,e,n){(this.mode&C)===C&&this.updateSamplePeak(t,e,n),(this.mode&A)===A&&this.updateTruePeak(t,e,n),this.updateAudioData(t,e,n)},a.prototype.calc_gating_block=function(t,e){for(var n=0,r=this.audio_data_index,o=this.audio_data_frames,a=0;a<this.channels;++a)if(this.channel_map[a]!==h){var s=0,u=this.audio_data[a];if(t>r){for(var l=0;r>l;++l)s+=u[l]*u[l];for(var l=o-(t-r);o>l;++l)s+=u[l]*u[l]}else for(var l=r-t;r>l;++l)s+=u[l]*u[l];this.channel_map[a]===v||this.channel_map[a]===m?s*=1.41:this.channel_map[a]===y&&(s*=2),n+=s}if(n/=t,e)e.result=n;else if(n>=S[0])if(this.use_histogram){var c=i(n);this.block_energy_histogram[c]=this.block_energy_histogram[c]+1}else this.block_list.unshift(n)},a.prototype.checkSilence=function(){var t=this.loudness_momentary();l>t?-1===this.lastSilenceStarted&&(this.lastSilenceStarted=this.currentTime):-1!==this.lastSilenceStarted&&(0===this.lastSilenceStarted&&(this.beginSilenceLength=this.currentTime),this.lastSilenceStarted=-1)},a.prototype.checkEndSilence=function(){-1!==this.lastSilenceStarted&&(this.endSilenceLength=this.currentTime-this.lastSilenceStarted,this.lastSilenceStarted=-1)},a.prototype.energy_shortterm=function(){return this.energy_in_interval(30*this.samples_in_100ms)},a.prototype.add_frames=function(t,e){for(var n=0;e>0;)if(e>=this.needed_frames){if(this.filter(t,n,this.needed_frames),n+=this.needed_frames,e-=this.needed_frames,this.audio_data_index+=this.needed_frames,(this.mode&w)===w&&this.calc_gating_block(4*this.samples_in_100ms,null),(this.mode&E)===E){if(this.short_term_frame_counter+=this.needed_frames,this.short_term_frame_counter===30*this.samples_in_100ms){var r=this.energy_shortterm();if(r>=S[0])if(this.use_histogram){var o=i(r);this.block_energy_histogram[o]=this.block_energy_histogram[o]+1}else this.short_term_block_list.unshift(r)}this.short_term_frame_counter=20*this.samples_in_100ms}this.checkSilence(),this.currentTime+=this.needed_frames,this.needed_frames=this.samples_in_100ms,this.audio_data_index===this.audio_data_frames&&(this.audio_data_index=0)}else this.filter(t,n,e),this.audio_data_index+=e,(this.mode&E)===E&&(this.short_term_frame_counter+=e),this.checkSilence(),this.currentTime+=e,this.needed_frames-=e,e=0},a.gated_loudness=function(t){for(var e=0,n=0,o=0,a=t.length,s=0;a>s;++s)if(t[s]&&(t[s].mode&w)!==w)throw new Error("invalid mode");for(var s=0;a>s;++s)if(t[s])if(t[s].use_histogram)for(var u=0;1e3>u;++u)e+=t[s].block_energy_histogram[u]*R[u],o+=t[s].block_energy_histogram[u];else for(var l=0;l<t[s].block_list.length;++l)++o,e+=t[s].block_list[l];if(!o)return-(1/0);e/=o,e*=x,o=0;var c;for(e<S[0]?c=0:(c=i(e),e>R[c]&&++c),s=0;a>s;s++)if(t[s])if(t[s].use_histogram)for(var u=c;1e3>u;++u)n+=t[s].block_energy_histogram[u]*R[u],o+=t[s].block_energy_histogram[u];else for(var l=0;l<t[s].block_list.length;++l){var f=t[s].block_list[l];f>=e&&(++o,n+=f)}return o?(n/=o,r(n)):-(1/0)},a.loudness_global=function(t){return a.gated_loudness([t])},a.loudness_global_multiple=function(t){return a.gated_loudness(t)},a.prototype.energy_in_interval=function(t){if(t>this.audio_data_frames)throw new Error("invalid mode");var e={result:0};return this.calc_gating_block(t,e),e.result},a.prototype.loudness_momentary=function(){var t=this.energy_in_interval(4*this.samples_in_100ms);return 0>=t?-(1/0):r(t)},a.prototype.loudness_shortterm=function(){var t=this.energy_shortterm();return 0>=t?-(1/0):r(t)},a.prototype.getSamplePeak=function(){if((this.mode&C)!==C)throw new Error("Wrong mode");for(var t=new Array(this.channels),e=0;e<t.length;++e)t[e]=this.sample_peak[e];return t},a.prototype.getTruePeak=function(){if((this.mode&A)!==A)throw new Error("Wrong mode");for(var t=new Array(this.channels),e=0;e<t.length;++e)t[e]=Math.max(this.true_peak[e],this.sample_peak[e]);return t},a.prototype.getSilence=function(){return this.checkEndSilence(),{beginSilenceLength:this.beginSilenceLength/this.samplerate,endSilenceLength:this.endSilenceLength/this.samplerate}},a.prototype.loudness_global=function(){return a.loudness_global(this)};const I=1;a.prototype.serialize=function(){var t=40,e=t+4*this.block_list.length,n=(this.mode&A)===A?this.getTruePeak():NaN,r=(this.mode&C)===C?this.getSamplePeak():NaN;n&&(n=Math.max.apply(Math,n)),r&&(r=Math.max.apply(Math,r));for(var i="EBUR128 "+u.int32BEString(I)+u.uint32BEString(e)+u.uint32BEString(this.mode)+u.uint32BEString(this.channels)+u.uint32BEString(this.samplerate)+u.float32BEString(n)+u.float32BEString(r)+u.uint32BEString(this.block_list.length),o=0;o<this.block_list.length;++o)i+=u.float32BEString(this.block_list[o]);return i},s.prototype.getTruePeak=function(){return this.true_peak},s.prototype.getSamplePeak=function(){return this.sample_peak},s.prototype.loudness_global=a.prototype.loudness_global,e.exports=a},{"lib/util":23}],14:[function(t,e,n){"use strict";function r(t,e,n){if("wav"!==t)return t;if(n>=e.end-22)return"wav";var r=e.getUint16(n+20,!0);switch(r){case 85:return"mp3";case 1:return"wav";case 3:return"wav";default:return"unknown"}}const i=1380533830,o=1463899717,a=4801587,s=1332176723,u=440786851,l=65521,c=65529,f={"audio/mp3":"mp3","audio/mpeg":"mp3"},h={mp3:"mp3"},p=function(t){return!(-2097152!==(4292870144&t)||(t&3<<17)!==1<<17||61440===(61440&t)||3072===(3072&t))},d=/\.([a-z0-9]+)$/i,_=function(t){var e=t.match(d);return e?e[1].toLowerCase():null};n.getCodecName=function(t){return t.readBlockOfSizeAt(8192,0).then(function(){const e=t.end;for(var n=0;e-4>n;++n){var d=t.getInt32(n,!1);if(d===i&&e-12>n&&t.getInt32(n+8)===o)return r("wav",t,n);if(d>>>8===a||p(d))return r("mp3",t,n);if(d>>>16===l||d>>>16===c)return r("aac",t,n);if(d===u)return r("webm",t,n);if(d===s)return r("ogg",t,n)}var v=t.file;if(f[v.type])return f[v.type];var m=_(v.name);return m?h[etx]||null:null})}},{}],15:[function(t,e,n){"use strict";function r(t){return t&&"NotReadableError"===t.name}function i(t){this.file=t,this.dataview=null,this.buffer=null,this.start=-1,this.end=-1,this._readInProgress=!1}const o=t("lib/bluebird"),a=t("lib/blobpatch");a();const s=t("lib/util");i.prototype.toBufferOffset=function(t){return t-this.start},i.prototype.ensure=function(t,e){if(!(this.start<=t&&t+e<=this.end))throw new Error("read out of bounds")},i.prototype.getFloat64=function(t,e){return this.dataview.getFloat64(t-this.start,e)},i.prototype.getFloat32=function(t,e){return this.dataview.getFloat32(t-this.start,e)},i.prototype.getUint32=function(t,e){return this.dataview.getUint32(t-this.start,e)},i.prototype.getInt32=function(t,e){return this.dataview.getInt32(t-this.start,e)},i.prototype.getUint16=function(t,e){return this.dataview.getUint16(t-this.start,e)},i.prototype.getInt16=function(t,e){return this.dataview.getInt16(t-this.start,e)},i.prototype.getUint8=function(t){return this.dataview.getUint8(t-this.start)},i.prototype.getInt8=function(t){return this.dataview.getInt8(t-this.start)},i.prototype.block=function(){if(!this.buffer)throw new Error("no block available");return this.buffer},i.prototype.modifyBlock=function(t){if(!this.buffer)throw new Error("no block available");var e=this.buffer.length,n=t(this.buffer),r=n.length-e,i=this.start,o=this.end;i+=r,o+=r,i=Math.max(0,Math.min(this.file.size,i)),o=Math.max(0,Math.min(this.file.size,o)),o=Math.max(i,o),this.start=i,this.end=o,this.buffer=new Uint8Array(n),this.dataview=new DataView(n)},i.prototype.readBlockOfSizeAt=function(t,e,n){if(this._readInProgress)return o.reject(new Error("invalid parallel read"));this._readInProgress=!0;var i=this;return t=Math.ceil(t),e=Math.ceil(e),new o(function(a,u){(!n||1>=n||void 0===n)&&(n=1);var l=i.file.size,c=Math.min(l-1,Math.max(0,e)),f=Math.min(l,c+t);return i.buffer&&i.start<=c&&f<=i.end?a():(f=Math.min(l,c+t*n),i.start=c,i.end=f,i.buffer=null,i.dataview=null,void a(function h(t){var e=i.file.slice(i.start,i.end);return s.readAsArrayBuffer(e)["finally"](function(){e.close()}).then(function(t){i.buffer=new Uint8Array(t),i.dataview=new DataView(t)})["catch"](function(e){if(r(e)&&5>t)return o.delay(500).then(function(){return h(t+1)});throw i.start=i.end=-1,i.buffer=null,i.dataview=null,e})}(0)))})["finally"](function(){i._readInProgress=!1})},e.exports=i},{"lib/blobpatch":16,"lib/bluebird":17,"lib/util":23}],16:[function(t,e,n){"use strict";function r(t){return t.charAt(0).toUpperCase()+t.slice(1)}function i(t,e){var n=r(e);return t.prototype[e]||t.prototype["ms"+n]||t.prototype["moz"+n]||t.prototype["webkit"+n]}function o(){if("undefined"!=typeof Blob){const t=i(Blob,"close");"undefined"==typeof t?Blob.prototype.close=function(){}:Blob.prototype.close=function(){try{return t.apply(this,arguments)}catch(e){}},"function"!=typeof Blob.prototype.slice&&(Blob.prototype.slice=i(Blob,"slice"))}if("undefined"!=typeof File){const e=i(File,"close");"undefined"==typeof e?File.prototype.close=function(){}:e!==Blob.prototype.close&&(e.prototype.close=function(){try{return e.apply(this,arguments)}catch(t){}}),"function"!=typeof File.prototype.slice&&(File.prototype.slice=i(File,"slice"))}}e.exports=o},{}],17:[function(e,n,r){(function(e,i){!function(e){if("object"==typeof r&&"undefined"!=typeof n)n.exports=e();else if("function"==typeof t&&t.amd)t([],e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof i?o=i:"undefined"!=typeof self&&(o=self),o.Promise=e()}}(function(){var t,n,r;return function o(t,e,n){function r(a,s){if(!e[a]){if(!t[a]){var u="function"==typeof _dereq_&&_dereq_;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=e[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,o,t,e,n)}return e[a].exports}for(var i="function"==typeof _dereq_&&_dereq_,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,e,n){"use strict";e.exports=function(t){function e(t){var e=new n(t),r=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),r}var n=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,n,r){"use strict";function i(){this._isTickUsed=!1,this._lateQueue=new f(16),this._normalQueue=new f(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=c}function o(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function a(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function s(t){this._normalQueue._pushOne(t),this._queueTick()}var u;try{throw new Error}catch(l){u=l}var c=t("./schedule"),f=t("./queue"),h=t("./util");i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){h.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(t,n){n?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)),e.exit(2)):this.throwLater(t)},i.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(n){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},h.hasDevTools?(i.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?o.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},i.prototype.invoke=function(t,e,n){this._trampolineEnabled?a.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},i.prototype.settlePromises=function(t){this._trampolineEnabled?s.call(this,t):this._schedule(function(){t._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=a,i.prototype.settlePromises=s),i.prototype.invokeFirst=function(t,e,n){this._normalQueue.unshift(t,e,n),this._queueTick()},i.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},n.exports=i,n.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){var i=!1,o=function(t,e){this._reject(e)},a=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},s=function(t,e){0===(50397184&this._bitField)&&this._resolveCallback(e.target)},u=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var l=n(o),c=new t(e);c._propagateFrom(this,1);var f=this._target();if(c._setBoundTo(l),l instanceof t){var h={promiseRejectionQueued:!1,promise:c,target:f,bindingPromise:l};f._then(e,a,void 0,c,h),l._then(s,u,void 0,c,h),c._setOnCancel(l)}else c._resolveCallback(f);return c},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},{}],4:[function(t,e,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(t){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=t("./promise")();o.noConflict=r,e.exports=o},{"./promise":22}],5:[function(t,e,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}e.exports=function(e){function n(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var i="Object "+s.classString(t)+" has no method '"+s.toString(n)+"'";throw new e.TypeError(i)}return r}function r(t){var e=this.pop(),r=n(t,e);return r.apply(t,this)}function i(t){return t[this]}function o(t){var e=+this;return 0>e&&(e=Math.max(0,e+t.length)),t[e]}var a,s=t("./util"),u=s.canEvaluate;s.isIdentifier;e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(r,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e,n="number"==typeof t;if(n)e=o;else if(u){var r=a(t);e=null!==r?r:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util"),a=o.tryCatch,s=o.errorObj,u=e._async;e.prototype["break"]=e.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t.isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n.isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),e=t,t=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled();
},e.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=a(t).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),u.throwLater(r.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,n){"use strict";e.exports=function(e){function n(t,n,s){return function(u){var l=s._boundValue();t:for(var c=0;c<t.length;++c){var f=t[c];if(f===Error||null!=f&&f.prototype instanceof Error){if(u instanceof f)return o(n).call(l,u)}else if("function"==typeof f){var h=o(f).call(l,u);if(h===a)return h;if(h)return o(n).call(l,u)}else if(r.isObject(u)){for(var p=i(f),d=0;d<p.length;++d){var _=p[d];if(f[_]!=u[_])continue t}return o(n).call(l,u)}}return e}}var r=t("./util"),i=t("./es5").keys,o=r.tryCatch,a=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(t,e,n){"use strict";e.exports=function(t){function e(){this._trace=new e.CapturedTrace(r())}function n(){return i?new e:void 0}function r(){var t=o.length-1;return t>=0?o[t]:void 0}var i=!1,o=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=o.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=n,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var n=t.prototype._pushContext,o=t.prototype._popContext,a=t._peekContext,s=t.prototype._peekContext,u=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=n,t.prototype._popContext=o,t._peekContext=a,t.prototype._peekContext=s,t.prototype._promiseCreated=u,i=!1},i=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=r,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},{}],9:[function(t,n,r){"use strict";n.exports=function(n,r){function i(t,e){return{promise:e}}function o(){return!1}function a(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+U.toString(t));r._attachCancellationCallback(t)})}catch(i){return i}}function s(t){if(!this.isCancellable())return this;var e=this._onCancel();void 0!==e?U.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function u(){return this._onCancelField}function l(t){this._onCancelField=t}function c(){this._cancellationParent=void 0,this._onCancelField=void 0}function f(t,e){if(0!==(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function h(t,e){0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var t=this._boundTo;return void 0!==t&&t instanceof n?t.isFulfilled()?t.value():void 0:t}function d(){this._trace=new I(this._peekContext())}function _(t,e){if(N(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=A(t);U.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),U.notEnumerableProp(t,"__stackCleaned__",!0)}}}function v(t,e,n,r,i){if(void 0===t&&null!==e&&K){if(void 0!==i&&i._returnedNonUndefined())return;n&&(n+=" ");var o="a promise was created in a "+n+"handler but was not returned from it";r._warn(o,!0,e)}}function m(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),y(n)}function y(t,e,r){if(it.warnings){var i,o=new D(t);if(e)r._attachExtraTrace(o);else if(it.longStackTraces&&(i=n._peekContext()))i.attachExtraTrace(o);else{var a=A(o);o.stack=a.message+"\n"+a.stack.join("\n")}Z("warning",o)||k(o,"",!0)}}function g(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}function b(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function w(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],a=-1,s=r.length-1;s>=0;--s)if(r[s]===o){a=s;break}for(var s=a;s>=0;--s){var u=r[s];if(e[i]!==u)break;e.pop(),i--}e=r}}function E(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i="    (No stack trace)"===r||V.test(r),o=i&&et(r);i&&!o&&(q&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function C(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||V.test(r))break}return n>0&&(e=e.slice(n)),e}function A(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?C(t):["    (No stack trace)"],{message:n,stack:E(e)}}function k(t,e,n){if("undefined"!=typeof console){var r;if(U.isObject(t)){var i=t.stack;r=e+H(i,t)}else r=e+String(t);"function"==typeof P?P(r,n):("function"==typeof console.log||"object"==typeof console.log)&&console.log(r)}}function x(t,e,n,r){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(o){B.throwLater(o)}"unhandledRejection"===t?Z(t,n,r)||i||k(n,"Unhandled rejection "):Z(t,r)}function R(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():U.toString(t);var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(e))try{var r=JSON.stringify(t);e=r}catch(i){}0===e.length&&(e="(empty array)")}return"(<"+S(e)+">, no stack trace)"}function S(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function F(){return"function"==typeof rt}function T(t){var e=t.match(nt);return e?{fileName:e[1],line:parseInt(e[2],10)}:void 0}function j(t,e){if(F()){for(var n,r,i=t.stack.split("\n"),o=e.stack.split("\n"),a=-1,s=-1,u=0;u<i.length;++u){var l=T(i[u]);if(l){n=l.fileName,a=l.line;break}}for(var u=0;u<o.length;++u){var l=T(o[u]);if(l){r=l.fileName,s=l.line;break}}0>a||0>s||!n||!r||n!==r||a>=s||(et=function(t){if(z.test(t))return!0;var e=T(t);return e&&e.fileName===n&&a<=e.line&&e.line<=s?!0:!1})}}function I(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);rt(this,I),e>32&&this.uncycle()}var O,M,P,L=n._getDomain,B=n._async,D=t("./errors").Warning,U=t("./util"),N=U.canAttachTrace,z=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,V=null,H=null,q=!1,G=!(0==U.env("BLUEBIRD_DEBUG")),Q=!(0==U.env("BLUEBIRD_WARNINGS")||!G&&!U.env("BLUEBIRD_WARNINGS")),$=!(0==U.env("BLUEBIRD_LONG_STACK_TRACES")||!G&&!U.env("BLUEBIRD_LONG_STACK_TRACES")),K=0!=U.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(Q||!!U.env("BLUEBIRD_W_FORGOTTEN_RETURN"));n.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),B.invokeLater(this._notifyUnhandledRejection,this,void 0))},n.prototype._notifyUnhandledRejectionIsHandled=function(){x("rejectionHandled",O,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),x("unhandledRejection",M,t,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(t,e,n){return y(t,e,n||this)},n.onPossiblyUnhandledRejection=function(t){var e=L();M="function"==typeof t?null===e?t:e.bind(t):void 0},n.onUnhandledRejectionHandled=function(t){var e=L();O="function"==typeof t?null===e?t:e.bind(t):void 0};var W=function(){};n.longStackTraces=function(){if(B.haveItemsQueued()&&!it.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!it.longStackTraces&&F()){var t=n.prototype._captureStackTrace,e=n.prototype._attachExtraTrace;it.longStackTraces=!0,W=function(){if(B.haveItemsQueued()&&!it.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");n.prototype._captureStackTrace=t,n.prototype._attachExtraTrace=e,r.deactivateLongStackTraces(),B.enableTrampoline(),it.longStackTraces=!1},n.prototype._captureStackTrace=d,n.prototype._attachExtraTrace=_,r.activateLongStackTraces(),B.disableTrampolineIfNecessary()}},n.hasLongStackTraces=function(){return it.longStackTraces&&F()};var X=function(){try{var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),U.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!U.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),J=function(){return U.isNode?function(){return e.emit.apply(e,arguments)}:U.global?function(t){var e="on"+t.toLowerCase(),n=U.global[e];return n?(n.apply(U.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}(),Y={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:i},Z=function(t){var e=!1;try{e=J.apply(null,arguments)}catch(n){B.throwLater(n),e=!0}var r=!1;try{r=X(t,Y[t].apply(null,arguments))}catch(n){B.throwLater(n),r=!0}return r||e};n.config=function(t){if(t=Object(t),"longStackTraces"in t&&(t.longStackTraces?n.longStackTraces():!t.longStackTraces&&n.hasLongStackTraces()&&W()),"warnings"in t){var e=t.warnings;it.warnings=!!e,K=it.warnings,U.isObject(e)&&"wForgottenReturn"in e&&(K=!!e.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!it.cancellation){if(B.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=c,n.prototype._propagateFrom=f,n.prototype._onCancel=u,n.prototype._setOnCancel=l,n.prototype._attachCancellationCallback=s,n.prototype._execute=a,tt=f,it.cancellation=!0}"monitoring"in t&&(t.monitoring&&!it.monitoring?(it.monitoring=!0,n.prototype._fireEvent=Z):!t.monitoring&&it.monitoring&&(it.monitoring=!1,n.prototype._fireEvent=o))},n.prototype._fireEvent=o,n.prototype._execute=function(t,e,n){try{t(e,n)}catch(r){return r}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(t){},n.prototype._attachCancellationCallback=function(t){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(t,e){};var tt=h,et=function(){return!1},nt=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;U.inherits(I,Error),r.CapturedTrace=I,I.prototype.uncycle=function(){var t=this._length;if(!(2>t)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;t=this._length=r;for(var r=t-1;r>=0;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;t>r;++r){var a=e[r].stack,s=n[a];if(void 0!==s&&s!==r){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var u=r>0?e[r-1]:this;t-1>s?(u._parent=e[s+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var l=u._length+1,c=r-2;c>=0;--c)e[c]._length=l,l++;return}}}},I.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=A(t),n=e.message,r=[e.stack],i=this;void 0!==i;)r.push(E(i.stack.split("\n"))),i=i._parent;w(r),b(r),U.notEnumerableProp(t,"stack",g(n,r)),U.notEnumerableProp(t,"__stackCleaned__",!0)}};var rt=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():R(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,V=t,H=e;var n=Error.captureStackTrace;return et=function(t){return z.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return V=/@/,H=e,q=!0,function(t){t.stack=(new Error).stack};var i;try{throw new Error}catch(o){i="stack"in o}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(H=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?R(e):e.toString()},null):(V=t,H=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(P=function(t){console.warn(t)},U.isNode&&e.stderr.isTTY?P=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:U.isNode||"string"!=typeof(new Error).stack||(P=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var it={warnings:Q,longStackTraces:!1,cancellation:!1,monitoring:!1};return $&&n.longStackTraces(),{longStackTraces:function(){return it.longStackTraces},warnings:function(){return it.warnings},cancellation:function(){return it.cancellation},monitoring:function(){return it.monitoring},propagateFromFunction:function(){return tt},boundValueFunction:function(){return p},checkForgottenReturns:v,setBounds:j,warn:y,deprecated:m,CapturedTrace:I,fireDomEvent:X,fireGlobalEvent:J}}},{"./errors":12,"./util":36}],10:[function(t,e,n){"use strict";e.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype["return"]=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype["throw"]=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1],r=function(){throw e};return this.caught(t,r)},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];r instanceof t&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){function n(){return o(this)}function r(t,n){return i(t,n,e,e)}var i=t.reduce,o=t.all;t.prototype.each=function(t){return this.mapSeries(t)._then(n,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,e){return r(t,e)._then(n,void 0,void 0,t,void 0)},t.mapSeries=r}},{}],12:[function(t,e,n){"use strict";function r(t,e){function n(r){return this instanceof n?(f(this,"message","string"==typeof r?r:e),f(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(r)}return c(n,Error),n}function i(t){return this instanceof i?(f(this,"name","OperationalError"),f(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(f(this,"message",t.message),f(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(t)}var o,a,s=t("./es5"),u=s.freeze,l=t("./util"),c=l.inherits,f=l.notEnumerableProp,h=r("Warning","warning"),p=r("CancellationError","cancellation error"),d=r("TimeoutError","timeout error"),_=r("AggregateError","aggregate error");try{o=TypeError,a=RangeError}catch(v){o=r("TypeError","type error"),a=r("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<m.length;++y)"function"==typeof Array.prototype[m[y]]&&(_.prototype[m[y]]=Array.prototype[m[y]]);s.defineProperty(_.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),_.prototype.isOperational=!0;var g=0;_.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];r=i.join("\n"),e+=r+"\n"}return g--,e},c(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:p,TimeoutError:d,OperationalError:i,RejectionError:i,AggregateError:_}),s.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:o,RangeError:a,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(t,e,n){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e},u=function(t,e){return{value:t[e]}},l=function(t,e,n){return t[e]=n.value,t},c=function(t){return t},f=function(t){try{return Object(t).constructor.prototype}catch(e){return a}},h=function(t){try{return"[object Array]"===o.call(t)}catch(e){return!1}};e.exports={isArray:h,keys:s,names:s,defineProperty:l,getDescriptor:u,freeze:c,getPrototypeOf:f,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,i){return n(t,r,i,e)}}},{}],15:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function i(t){this.finallyHandler=t}function o(t,e){return null!=t.cancelPromise?(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0):!1}function a(){return u.call(this,this.promise._target()._settledValue())}function s(t){return o(this,t)?void 0:(f.e=t,f)}function u(t){var r=this.promise,u=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?u.call(r._boundValue()):u.call(r._boundValue(),t);if(void 0!==l){r._setReturnedNonUndefined();var h=n(l,r);if(h instanceof e){if(null!=this.cancelPromise){if(h.isCancelled()){var p=new c("late cancellation observer");return r._attachExtraTrace(p),f.e=p,f}h.isPending()&&h._attachCancellationCallback(new i(this))}return h._then(a,s,void 0,this,void 0)}}}return r.isRejected()?(o(this),f.e=t,f):(o(this),t)}var l=t("./util"),c=e.CancellationError,f=l.errorObj;return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},e.prototype._passThrough=function(t,e,n,i){return"function"!=typeof t?this.then():this._then(n,i,void 0,new r(this,e,t),void 0)},e.prototype.lastly=e.prototype["finally"]=function(t){return this._passThrough(t,0,u,u)},e.prototype.tap=function(t){return this._passThrough(t,1,u)},r}},{"./util":36}],16:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,a){function s(t,n,r){for(var o=0;o<n.length;++o){r._pushContext();var a=p(n[o])(t);if(r._popContext(),a===h){r._pushContext();var s=e.reject(h.e);return r._popContext(),s}var u=i(a,r);if(u instanceof e)return u}return null}function u(t,n,i,o){var a=this._promise=new e(r);a._captureStackTrace(),a._setOnCancel(this),this._stack=o,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d,this._yieldedPromise=null}var l=t("./errors"),c=l.TypeError,f=t("./util"),h=f.errorObj,p=f.tryCatch,d=[];f.inherits(u,o),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var t,n="undefined"!=typeof this._generator["return"];if(n)this._promise._pushContext(),t=p(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var r=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),t=p(this._generator["throw"]).call(this._generator,r),this._promise._popContext(),t===h&&t.e===r&&(t=null)}var i=this._promise;this._cleanup(),t===h?i._rejectCallback(t.e,!1):i.cancel()}},u.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=p(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},u.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=p(this._generator["throw"]).call(this._generator,t);this._promise._popContext(),this._continue(e)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(t){var n=this._promise;if(t===h)return this._cleanup(),n._rejectCallback(t.e,!1);var r=t.value;if(t.done===!0)return this._cleanup(),n._resolveCallback(r);var o=i(r,this._promise);if(!(o instanceof e)&&(o=s(o,this._yieldHandlers,this._promise),null===o))return void this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",r)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var a=o._bitField;0===(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!==(33554432&a)?this._promiseFulfilled(o._value()):0!==(16777216&a)?this._promiseRejected(o._reason()):this._promiseCancelled()},e.coroutine=function(t,e){if("function"!=typeof t)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(e).yieldHandler,r=u,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new r(void 0,void 0,n,i),a=o.promise();return o._generator=e,o._promiseFulfilled(void 0),a}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new c("expecting a function but got "+f.classString(t));d.push(t)},e.spawn=function(t){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new u(t,this),i=r.promise();return r._run(e.spawn),i}}},{"./errors":12,"./util":36}],17:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util");o.canEvaluate,o.tryCatch,o.errorObj;e.join=function(){var t,e=arguments.length-1;if(e>0&&"function"==typeof arguments[e]){t=arguments[e];var r}var i=[].slice.call(arguments);t&&i.pop();var r=new n(i).promise();return void 0!==t?r.spread(t):r}}},{"./util":36}],18:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,a){function s(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var i=l();this._callback=null===i?e:i.bind(e),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:p,this._init$(void 0,-2)}function u(t,e,n,i){if("function"!=typeof e)return r("expecting a function but got "+c.classString(e));var o="object"==typeof n&&null!==n?n.concurrency:0;return o="number"==typeof o&&isFinite(o)&&o>=1?o:0,new s(t,e,o,i).promise()}var l=e._getDomain,c=t("./util"),f=c.tryCatch,h=c.errorObj,p=[];c.inherits(s,n),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,n){var r=this._values,o=this.length(),s=this._preservedValues,u=this._limit;if(0>n){if(n=-1*n-1,r[n]=t,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return r[n]=t,this._queue.push(n),!1;null!==s&&(s[n]=t);var l=this._promise,c=this._callback,p=l._boundValue();l._pushContext();var d=f(c).call(p,t,n,o),_=l._popContext();if(a.checkForgottenReturns(d,_,null!==s?"Promise.filter":"Promise.map",l),d===h)return this._reject(d.e),!0;var v=i(d,this._promise);if(v instanceof e){v=v._target();var m=v._bitField;if(0===(50397184&m))return u>=1&&this._inFlight++,r[n]=v,v._proxy(this,-1*(n+1)),!1;if(0===(33554432&m))return 0!==(16777216&m)?(this._reject(v._reason()),!0):(this._cancel(),!0);d=v._value()}r[n]=d}var y=++this._totalResolved;return y>=o?(null!==s?this._filter(r,s):this._resolve(r),!0):!1},s.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;n>o;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return u(this,t,e,null)},e.map=function(t,e,n,r){return u(t,e,n,r)}}},{"./util":36}],19:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){var a=t("./util"),s=a.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+a.classString(t));return function(){var r=new e(n);r._captureStackTrace(),r._pushContext();var i=s(t).apply(this,arguments),a=r._popContext();return o.checkForgottenReturns(i,a,"Promise.method",r),r._resolveFromSyncValue(i),r}},e.attempt=e["try"]=function(t){if("function"!=typeof t)return i("expecting a function but got "+a.classString(t));var r=new e(n);r._captureStackTrace(),r._pushContext();var u;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var l=arguments[1],c=arguments[2];u=a.isArray(l)?s(t).apply(c,l):s(t).call(c,l)}else u=s(t)();var f=r._popContext();return o.checkForgottenReturns(u,f,"Promise.try",r),r._resolveFromSyncValue(u),r},e.prototype._resolveFromSyncValue=function(t){t===a.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,n){"use strict";function r(t){return t instanceof Error&&c.getPrototypeOf(t)===Error.prototype}function i(t){var e;if(r(t)){e=new l(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var n=c.keys(t),i=0;i<n.length;++i){var o=n[i];f.test(o)||(e[o]=t[o])}return e}return a.markAsOriginatingFromRejection(t),t}function o(t,e){return function(n,r){if(null!==t){if(n){var o=i(s(n));t._attachExtraTrace(o),t._reject(o)}else if(e){var a=[].slice.call(arguments,1);t._fulfill(a)}else t._fulfill(r);t=null}}}var a=t("./util"),s=a.maybeWrapAsError,u=t("./errors"),l=u.OperationalError,c=t("./es5"),f=/^(?:name|message|stack|cause)$/;e.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){"use strict";e.exports=function(e){function n(t,e){var n=this;if(!o.isArray(t))return r.call(n,t,e);var i=s(e).apply(n._boundValue(),[null].concat(t));i===u&&a.throwLater(i.e)}function r(t,e){var n=this,r=n._boundValue(),i=void 0===t?s(e).call(r,null):s(e).call(r,null,t);i===u&&a.throwLater(i.e)}function i(t,e){var n=this;if(!t){var r=new Error(t+"");r.cause=t,t=r}var i=s(e).call(n._boundValue(),t);i===u&&a.throwLater(i.e)}var o=t("./util"),a=e._async,s=o.tryCatch,u=o.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var o=r;void 0!==e&&Object(e).spread&&(o=n),this._then(o,i,void 0,this,t)}return this}}},{"./util":36}],22:[function(t,n,r){"use strict";n.exports=function(){function n(){}function r(t,e){if("function"!=typeof e)throw new y("expecting a function but got "+p.classString(e));if(t.constructor!==i)throw new y("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function i(t){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,t!==b&&(r(this,t),this._resolveFromExecutor(t)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(t){this.promise._resolveCallback(t)}function a(t){this.promise._rejectCallback(t,!1)}function s(t){var e=new i(b);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var u,l=function(){return new y("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},c=function(){return new i.PromiseInspection(this._target())},f=function(t){return i.reject(new y(t))},h={},p=t("./util");u=p.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},p.notEnumerableProp(i,"_getDomain",u);var d=t("./es5"),_=t("./async"),v=new _;d.defineProperty(i,"_async",{value:v});var m=t("./errors"),y=i.TypeError=m.TypeError;i.RangeError=m.RangeError;var g=i.CancellationError=m.CancellationError;i.TimeoutError=m.TimeoutError,i.OperationalError=m.OperationalError,i.RejectionError=m.OperationalError,i.AggregateError=m.AggregateError;var b=function(){},w={},E={},C=t("./thenables")(i,b),A=t("./promise_array")(i,b,C,f,n),k=t("./context")(i),x=k.create,R=t("./debuggability")(i,k),S=(R.CapturedTrace,t("./finally")(i,C)),F=t("./catch_filter")(E),T=t("./nodeback"),j=p.errorObj,I=p.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype["catch"]=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),i=0;for(n=0;e-1>n;++n){var o=arguments[n];if(!p.isObject(o))return f("expecting an object but got "+p.classString(o));r[i++]=o}return r.length=i,t=arguments[n],this.then(void 0,F(r,t,this))}return this.then(void 0,t)},i.prototype.reflect=function(){return this._then(c,c,void 0,this,void 0)},i.prototype.then=function(t,e){if(R.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+p.classString(t);arguments.length>1&&(n+=", "+p.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},i.prototype.done=function(t,e){var n=this._then(t,e,void 0,void 0,void 0);n._setIsFinal()},i.prototype.spread=function(t){return"function"!=typeof t?f("expecting a function but got "+p.classString(t)):this.all()._then(t,void 0,void 0,w,void 0)},i.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new A(this).promise()},i.prototype.error=function(t){
return this.caught(p.originatesFromRejection,t)},i.is=function(t){return t instanceof i},i.fromNode=i.fromCallback=function(t){var e=new i(b);e._captureStackTrace();var n=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,r=I(t)(T(e,n));return r===j&&e._rejectCallback(r.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},i.all=function(t){return new A(t).promise()},i.cast=function(t){var e=C(t);return e instanceof i||(e=new i(b),e._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(t){var e=new i(b);return e._captureStackTrace(),e._rejectCallback(t,!0),e},i.setScheduler=function(t){if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t));var e=v._schedule;return v._schedule=t,e},i.prototype._then=function(t,e,n,r,o){var a=void 0!==o,s=a?o:new i(b),l=this._target(),c=l._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!==(2097152&this._bitField)&&(r=0!==(50397184&c)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var f=u();if(0!==(50397184&c)){var h,p,d=l._settlePromiseCtx;0!==(33554432&c)?(p=l._rejectionHandler0,h=t):0!==(16777216&c)?(p=l._fulfillmentHandler0,h=e,l._unsetRejectionIsUnhandled()):(d=l._settlePromiseLateCancellationObserver,p=new g("late cancellation observer"),l._attachExtraTrace(p),h=e),v.invoke(d,l,{handler:null===f?h:"function"==typeof h&&f.bind(h),promise:s,receiver:r,value:p})}else l._addCallbacks(t,e,s,r,f);return s},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},i.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},i.prototype._setAsyncGuaranteed=function(){this._bitField=134217728|this._bitField},i.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==h)return void 0===e&&this._isBound()?this._boundValue():e},i.prototype._promiseAt=function(t){return this[4*t-4+2]},i.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},i.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),n=t._rejectionHandler0,r=t._promise0,i=t._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(e,n,r,i,null)},i.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=h),this._addCallbacks(n,r,i,o,null)},i.prototype._addCallbacks=function(t,e,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===i?t:i.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===i?e:i.bind(e));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof t&&(this[a+0]=null===i?t:i.bind(t)),"function"==typeof e&&(this[a+1]=null===i?e:i.bind(e))}return this._setLength(o+1),o},i.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},i.prototype._resolveCallback=function(t,e){if(0===(117506048&this._bitField)){if(t===this)return this._rejectCallback(l(),!1);var n=C(t,this);if(!(n instanceof i))return this._fulfill(t);e&&this._propagateFrom(n,2);var r=n._target(),o=r._bitField;if(0===(50397184&o)){var a=this._length();a>0&&r._migrateCallback0(this);for(var s=1;a>s;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!==(33554432&o))this._fulfill(r._value());else if(0!==(16777216&o))this._reject(r._reason());else{var u=new g("late cancellation observer");r._attachExtraTrace(u),this._reject(u)}}},i.prototype._rejectCallback=function(t,e,n){var r=p.ensureErrorObject(t),i=r===t;if(!i&&!n&&R.warnings()){var o="a promise was rejected with a non-error: "+p.classString(t);this._warn(o,!0)}this._attachExtraTrace(r,e?i:!1),this._reject(t)},i.prototype._resolveFromExecutor=function(t){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)},i.prototype._settlePromiseFromHandler=function(t,e,n,r){var i=r._bitField;if(0===(65536&i)){r._pushContext();var o;e===w?n&&"number"==typeof n.length?o=I(t).apply(this._boundValue(),n):(o=j,o.e=new y("cannot .spread() a non-array: "+p.classString(n))):o=I(t).call(e,n);var a=r._popContext();if(i=r._bitField,0===(65536&i))if(o===E)r._reject(n);else if(o===j||o===r){var s=o===r?l():o.e;r._rejectCallback(s,!1)}else R.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)}},i.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(t){this._rejectionHandler0=t},i.prototype._settlePromise=function(t,e,r,o){var a=t instanceof i,s=this._bitField,u=0!==(134217728&s);0!==(65536&s)?(a&&t._invokeInternalOnCancel(),r instanceof S&&r.isFinallyHandler()?(r.cancelPromise=t,I(e).call(r,o)===j&&t._reject(j.e)):e===c?t._fulfill(c.call(r)):r instanceof n?r._promiseCancelled(t):a||t instanceof A?t._cancel():r.cancel()):"function"==typeof e?a?(u&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,r,o,t)):e.call(r,o,t):r instanceof n?r._isResolved()||(0!==(33554432&s)?r._promiseFulfilled(o,t):r._promiseRejected(o,t)):a&&(u&&t._setAsyncGuaranteed(),0!==(33554432&s)?t._fulfill(o):t._reject(o))},i.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,n=t.promise,r=t.receiver,o=t.value;"function"==typeof e?n instanceof i?this._settlePromiseFromHandler(e,r,o,n):e.call(r,o,n):n instanceof i&&n._reject(o)},i.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},i.prototype._settlePromise0=function(t,e,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,i,e)},i.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},i.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!==(134217728&e)?this._settlePromises():v.settlePromises(this))}},i.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?v.fatalError(t,p.isNode):void((65535&e)>0?0!==(134217728&e)?this._settlePromises():v.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(t,e){for(var n=1;t>n;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},i.prototype._rejectPromises=function(t,e){for(var n=1;t>n;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},i.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!==(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},i.prototype._settledValue=function(){var t=this._bitField;return 0!==(33554432&t)?this._rejectionHandler0:0!==(16777216&t)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){R.deprecated("Promise.defer","new Promise");var t=new i(b);return{promise:t,resolve:o,reject:a}},p.notEnumerableProp(i,"_makeSelfResolutionError",l),t("./method")(i,b,C,f,R),t("./bind")(i,b,C,R),t("./cancel")(i,A,f,R),t("./direct_resolve")(i),t("./synchronous_inspection")(i),t("./join")(i,A,C,b,R),i.Promise=i,t("./map.js")(i,A,f,C,b,R),t("./using.js")(i,f,C,x,b,R),t("./timers.js")(i,b,R),t("./generators.js")(i,f,b,C,n,R),t("./nodeify.js")(i),t("./call_get.js")(i),t("./props.js")(i,A,C,f),t("./race.js")(i,b,C,f),t("./reduce.js")(i,A,f,C,b,R),t("./settle.js")(i,A,R),t("./some.js")(i,A,f),t("./promisify.js")(i,b),t("./any.js")(i),t("./each.js")(i,b),t("./filter.js")(i,b),p.toFastProperties(i),p.toFastProperties(i.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new i(b)),R.setBounds(_.firstLineError,p.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){function a(t){switch(t){case-2:return[];case-3:return{}}}function s(t){var r=this._promise=new e(n);t instanceof e&&r._propagateFrom(t,3),r._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=t("./util");u.isArray;return u.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function l(t,n){var o=r(this._values,this._promise);if(o instanceof e){o=o._target();var s=o._bitField;if(this._values=o,0===(50397184&s))return this._promise._setAsyncGuaranteed(),o._then(l,this._reject,void 0,this,n);if(0===(33554432&s))return 0!==(16777216&s)?this._reject(o._reason()):this._cancel();o=o._value()}if(o=u.asArray(o),null===o){var c=i("expecting an array or an iterable object but got "+u.classString(o)).reason();return void this._promise._rejectCallback(c,!1)}return 0===o.length?void(-5===n?this._resolveEmptyArray():this._resolve(a(n))):void this._iterate(o)},s.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,a=null,s=0;n>s;++s){var u=r(t[s],i);u instanceof e?(u=u._target(),a=u._bitField):a=null,o?null!==a&&u.suppressUnhandledRejections():null!==a?0===(50397184&a)?(u._proxy(this,s),this._values[s]=u):o=0!==(33554432&a)?this._promiseFulfilled(u._value(),s):0!==(16777216&a)?this._promiseRejected(u._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(u,s)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},s.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;return n>=this._length?(this._resolve(this._values),!0):!1},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},{"./util":36}],24:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t){return!E.test(t)}function i(t){try{return t.__isPromisified__===!0}catch(e){return!1}}function o(t,e,n){var r=p.getDataPropertyOrDefault(t,e+n,b);return r?i(r):!1}function a(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<t.length;a+=2)if(t[a]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function s(t,e,n,r){for(var s=p.inheritedDataKeys(t),u=[],l=0;l<s.length;++l){var c=s[l],f=t[c],h=r===C?!0:C(c,f,t);"function"!=typeof f||i(f)||o(t,c,e)||!r(c,f,t,h)||u.push(c,f)}return a(u,e,n),u}function u(t,r,i,o,a,s){function u(){var i=r;r===h&&(i=this);var o=new e(n);o._captureStackTrace();var a="string"==typeof c&&this!==l?this[c]:t,u=d(o,s);try{a.apply(i,_(arguments,u))}catch(f){o._rejectCallback(v(f),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var l=function(){return this}(),c=t;return"string"==typeof c&&(t=o),p.notEnumerableProp(u,"__isPromisified__",!0),u}function l(t,e,n,r,i){for(var o=new RegExp(A(e)+"$"),a=s(t,e,o,n),u=0,l=a.length;l>u;u+=2){var c=a[u],f=a[u+1],d=c+e;if(r===k)t[d]=k(c,h,c,f,e,i);else{var _=r(f,function(){return k(c,h,c,f,e,i)});p.notEnumerableProp(_,"__isPromisified__",!0),t[d]=_}}return p.toFastProperties(t),t}function c(t,e,n){return k(t,e,void 0,t,null,n)}var f,h={},p=t("./util"),d=t("./nodeback"),_=p.withAppended,v=p.maybeWrapAsError,m=p.canEvaluate,y=t("./errors").TypeError,g="Async",b={__isPromisified__:!0},w=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],E=new RegExp("^(?:"+w.join("|")+")$"),C=function(t){return p.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},A=function(t){return t.replace(/([$])/,"\\$")},k=m?f:u;e.promisify=function(t,e){if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t));if(i(t))return t;e=Object(e);var n=void 0===e.context?h:e.context,o=!!e.multiArgs,a=c(t,n,o);return p.copyDescriptors(t,a,r),a},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");e=Object(e);var n=!!e.multiArgs,r=e.suffix;"string"!=typeof r&&(r=g);var i=e.filter;"function"!=typeof i&&(i=C);var o=e.promisifier;if("function"!=typeof o&&(o=k),!p.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=p.inheritedDataKeys(t),s=0;s<a.length;++s){var u=t[a[s]];"constructor"!==a[s]&&p.isClass(u)&&(l(u.prototype,r,i,o,n),l(u,r,i,o,n))}return l(t,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t){var e,n=!1;if(void 0!==s&&t instanceof s)e=f(t),n=!0;else{var r=c.keys(t),i=r.length;e=new Array(2*i);for(var o=0;i>o;++o){var a=r[o];e[o]=t[a],e[o+i]=a}}this.constructor$(e),this._isMap=n,this._init$(void 0,-3)}function a(t){var n,a=r(t);return l(a)?(n=a instanceof e?a._then(e.props,void 0,void 0,void 0,void 0):new o(a).promise(),a instanceof e&&n._propagateFrom(a,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,u=t("./util"),l=u.isObject,c=t("./es5");"function"==typeof Map&&(s=Map);var f=function(){function t(t,r){this[e]=t,this[e+n]=r,e++}var e=0,n=0;return function(r){n=r.size,e=0;var i=new Array(2*r.size);return r.forEach(t,i),i}}(),h=function(t){for(var e=new s,n=t.length/2|0,r=0;n>r;++r){var i=t[n+r],o=t[r];e.set(i,o)}return e};u.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var n=++this._totalResolved;if(n>=this._length){var r;if(this._isMap)r=h(this._values);else{r={};for(var i=this.length(),o=0,a=this.length();a>o;++o)r[this._values[o+i]]=this._values[o]}return this._resolve(r),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return a(this)},e.props=function(t){return a(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,n){"use strict";function r(t,e,n,r,i){for(var o=0;i>o;++o)n[o+r]=t[o+e],t[o+e]=void 0}function i(t){this._capacity=t,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var n=this._front+e&this._capacity-1;this[n]=t,this._length=e+1},i.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var n=this._front,r=(n-1&e-1^e)-e;this[r]=t,this._front=r,this._length=this.length()+1},i.prototype.unshift=function(t,e,n){this._unshiftOne(n),this._unshiftOne(e),this._unshiftOne(t)},i.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,i=this._length,o=n+i&e-1;r(this,0,this,e,o)},e.exports=i},{}],27:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t,o){var u=r(t);if(u instanceof e)return s(u);if(t=a.asArray(t),null===t)return i("expecting an array or an iterable object but got "+a.classString(t));var l=new e(n);void 0!==o&&l._propagateFrom(o,3);for(var c=l._fulfill,f=l._reject,h=0,p=t.length;p>h;++h){var d=t[h];(void 0!==d||h in t)&&e.cast(d)._then(c,f,void 0,l,null)}return l}var a=t("./util"),s=function(t){return t.then(function(e){return o(e,t)})};e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,a){function s(t,n,r,i){this.constructor$(t);var a=h();this._fn=null===a?n:a.bind(n),void 0!==r&&(r=e.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function l(t,e,n,i){if("function"!=typeof e)return r("expecting a function but got "+p.classString(e));var o=new s(t,e,n,i);return o.promise()}function c(t){this.accum=t,this.array._gotAccum(t);var n=i(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(f,void 0,void 0,this,void 0)):f.call(this,n)}function f(t){var n=this.array,r=n._promise,i=d(n._fn);r._pushContext();var o;o=void 0!==n._eachValues?i.call(r._boundValue(),t,this.index,this.length):i.call(r._boundValue(),this.accum,t,this.index,this.length),o instanceof e&&(n._currentCancellable=o);var s=r._popContext();return a.checkForgottenReturns(o,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var h=e._getDomain,p=t("./util"),d=p.tryCatch;p.inherits(s,n),s.prototype._gotAccum=function(t){void 0!==this._eachValues&&t!==o&&this._eachValues.push(t)},s.prototype._eachComplete=function(t){return this._eachValues.push(t),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},s.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel()))},s.prototype._iterate=function(t){this._values=t;var n,r,i=t.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;i>r;++r){var o={accum:null,value:t[r],index:r,length:i,array:this};n=n._then(c,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(u,u,void 0,n,this)},e.prototype.reduce=function(t,e){return l(this,t,e,null)},e.reduce=function(t,e,n,r){return l(t,e,n,r)}}},{"./util":36}],29:[function(t,n,r){"use strict";var o,a=t("./util"),s=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")};if(a.isNode&&"undefined"==typeof MutationObserver){var u=i.setImmediate,l=e.nextTick;o=a.isRecentNode?function(t){u.call(i,t)}:function(t){l.call(e,t)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:s:function(){var t=document.createElement("div"),e={attributes:!0},n=!1,r=document.createElement("div"),i=new MutationObserver(function(){t.classList.toggle("foo"),n=!1});i.observe(r,e);var o=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(t,e),o()}}();n.exports=o},{"./util":36}],30:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.constructor$(t)}var o=e.PromiseInspection,a=t("./util");a.inherits(i,n),i.prototype._promiseResolved=function(t,e){this._values[t]=e;var n=++this._totalResolved;return n>=this._length?(this._resolve(this._values),!0):!1},i.prototype._promiseFulfilled=function(t,e){var n=new o;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},i.prototype._promiseRejected=function(t,e){var n=new o;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},e.settle=function(t){return r.deprecated(".settle()",".reflect()"),new i(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||0>e)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(t),o=n.promise();return n.setHowMany(e),n.init(),o}var a=t("./util"),s=t("./errors").RangeError,u=t("./errors").AggregateError,l=a.isArray,c={};a.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=l(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(t){this._howMany=t},i.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1},i.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new u,e=this.length();e<this._values.length;++e)this._values[e]!==c&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(t){this._values.push(t)},i.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new s(e)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},a=e.prototype.isPending=function(){return 0===(50397184&this._bitField)},s=e.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};e.prototype.isCancelled=t.prototype._isCancelled=function(){return 65536===(65536&this._bitField)},t.prototype.isCancelled=function(){return this._target()._isCancelled()},t.prototype.isPending=function(){return a.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return s.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t,r){if(c(t)){if(t instanceof e)return t;var i=o(t);if(i===l){r&&r._pushContext();var u=e.reject(i.e);return r&&r._popContext(),u}if("function"==typeof i){if(a(t)){var u=new e(n);return t._then(u._fulfill,u._reject,void 0,u,null),u}return s(t,i,r)}}return t}function i(t){return t.then}function o(t){try{return i(t)}catch(e){return l.e=e,l}}function a(t){return f.call(t,"_promise0")}function s(t,r,i){function o(t){s&&(s._resolveCallback(t),s=null)}function a(t){s&&(s._rejectCallback(t,f,!0),s=null)}var s=new e(n),c=s;i&&i._pushContext(),s._captureStackTrace(),i&&i._popContext();var f=!0,h=u.tryCatch(r).call(t,o,a);return f=!1,s&&h===l&&(s._rejectCallback(h.e,!0,!0),s=null),c}var u=t("./util"),l=u.errorObj,c=u.isObject,f={}.hasOwnProperty;return r}},{"./util":36}],34:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.handle=t}function o(t){return clearTimeout(this.handle),t}function a(t){throw clearTimeout(this.handle),t}var s=t("./util"),u=e.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(t){return c(+this).thenReturn(t)},c=e.delay=function(t,o){var a,s;return void 0!==o?(a=e.resolve(o)._then(l,null,null,t,void 0),r.cancellation()&&o instanceof e&&a._setOnCancel(o)):(a=new e(n),s=setTimeout(function(){a._fulfill()},+t),r.cancellation()&&a._setOnCancel(new i(s))),a._setAsyncGuaranteed(),a};e.prototype.delay=function(t){return c(t,this)};var f=function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new u("operation timed out"):new u(e),s.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()};e.prototype.timeout=function(t,e){t=+t;var n,s,u=new i(setTimeout(function(){n.isPending()&&f(n,e,s)},t));return r.cancellation()?(s=this.then(),n=s._then(o,a,void 0,u,void 0),n._setOnCancel(u)):n=this._then(o,a,void 0,u,void 0),n}}},{"./util":36}],35:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,a){function s(t){setTimeout(function(){throw t},0)}function u(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function l(t,n){function i(){if(a>=l)return c._fulfill();var o=u(t[a++]);if(o instanceof e&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),t.promise)}catch(f){return s(f)}if(o instanceof e)return o._then(i,s,null,null,null)}i()}var a=0,l=t.length,c=new e(o);return i(),c}function c(t,e,n){this._data=t,this._promise=e,this._context=n}function f(t,e,n){this.constructor$(t,e,n)}function h(t){return c.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function p(t){this.length=t,this.promise=null,this[t-1]=null}var d=t("./util"),_=t("./errors").TypeError,v=t("./util").inherits,m=d.errorObj,y=d.tryCatch;c.prototype.data=function(){return this._data},c.prototype.promise=function(){return this._promise},c.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},c.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=null!==e?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},c.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},v(f,c),f.prototype.doDispose=function(t,e){var n=this.data();return n.call(t,t,e)},p.prototype._resultCancelled=function(){for(var t=this.length,n=0;t>n;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var t=arguments.length;if(2>t)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return n("expecting a function but got "+d.classString(i));var o,s=!0;2===t&&Array.isArray(arguments[0])?(o=arguments[0],t=o.length,s=!1):(o=arguments,t--);for(var u=new p(t),f=0;t>f;++f){var _=o[f];if(c.isDisposer(_)){var v=_;_=_.promise(),_._setDisposable(v)}else{var g=r(_);g instanceof e&&(_=g._then(h,null,null,{resources:u,index:f},void 0))}u[f]=_}for(var b=new Array(u.length),f=0;f<b.length;++f)b[f]=e.resolve(u[f]).reflect();var w=e.all(b).then(function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return m.e=n.error(),m;if(!n.isFulfilled())return void w.cancel();t[e]=n.value()}E._pushContext(),i=y(i);var r=s?i.apply(void 0,t):i(t),o=E._popContext();return a.checkForgottenReturns(r,o,"Promise.using",E),r}),E=w.lastly(function(){var t=new e.PromiseInspection(w);return l(u,t)});return u.promise=E,E._setOnCancel(u),E},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new f(t,this,i());throw new _}}},{"./errors":12,"./util":36}],36:[function(t,n,r){"use strict";function o(){try{var t=F;return F=null,t.apply(this,arguments)}catch(e){return S.e=e,S}}function a(t){
return F=t,o}function s(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function u(t){return"function"==typeof t||"object"==typeof t&&null!==t}function l(t){return s(t)?new Error(y(t)):t}function c(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;r>n;++n)i[n]=t[n];return i[n]=e,i}function f(t,e,n){if(!x.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function h(t,e,n){if(s(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return x.defineProperty(t,e,r),t}function p(t){throw t}function d(t){try{if("function"==typeof t){var e=x.names(t.prototype),n=x.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=O.test(t+"")&&x.names(t).length>0;if(n||r||i)return!0}return!1}catch(o){return!1}}function _(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t}function v(t){return M.test(t)}function m(t,e,n){for(var r=new Array(t),i=0;t>i;++i)r[i]=e+i+n;return r}function y(t){try{return t+""}catch(e){return"[no string representation]"}}function g(t){return null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function b(t){try{h(t,"isOperational",!0)}catch(e){}}function w(t){return null==t?!1:t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0}function E(t){return g(t)&&x.propertyIsWritable(t,"stack")}function C(t){return{}.toString.call(t)}function A(t,e,n){for(var r=x.names(t),i=0;i<r.length;++i){var o=r[i];if(n(o))try{x.defineProperty(e,o,x.getDescriptor(t,o))}catch(a){}}}function k(t,n){return D?e.env[t]:n}var x=t("./es5"),R="undefined"==typeof navigator,S={e:{}},F,T="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof i?i:void 0!==this?this:null,j=function(t,e){function n(){this.constructor=t,this.constructor$=e;for(var n in e.prototype)r.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var r={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},I=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(x.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var r=[],i=Object.create(null);null!=t&&!e(t);){var o;try{o=n(t)}catch(a){return r}for(var s=0;s<o.length;++s){var u=o[s];if(!i[u]){i[u]=!0;var l=Object.getOwnPropertyDescriptor(t,u);null!=l&&null==l.get&&null==l.set&&r.push(u)}}t=x.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(n){if(e(n))return[];var i=[];t:for(var o in n)if(r.call(n,o))i.push(o);else{for(var a=0;a<t.length;++a)if(r.call(t[a],o))continue t;i.push(o)}return i}}(),O=/this\s*\.\s*\S+\s*=/,M=/^[a-z$_][a-z$_0-9]*$/i,P=function(){return"stack"in new Error?function(t){return E(t)?t:new Error(y(t))}:function(t){if(E(t))return t;try{throw new Error(y(t))}catch(e){return e}}}(),L=function(t){return x.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var B="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};L=function(t){return x.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?B(t):null}}var D="undefined"!=typeof e&&"[object process]"===C(e).toLowerCase(),U={isClass:d,isIdentifier:v,inheritedDataKeys:I,getDataPropertyOrDefault:f,thrower:p,isArray:x.isArray,asArray:L,notEnumerableProp:h,isPrimitive:s,isObject:u,isError:g,canEvaluate:R,errorObj:S,tryCatch:a,inherits:j,withAppended:c,maybeWrapAsError:l,toFastProperties:_,filledRange:m,toString:y,canAttachTrace:E,ensureErrorObject:P,originatesFromRejection:w,markAsOriginatingFromRejection:b,classString:C,copyDescriptors:A,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:D,env:k,global:T};U.isRecentNode=U.isNode&&function(){var t=e.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),U.isNode&&U.toFastProperties(e);try{throw new Error}catch(N){U.lastLineError=N}n.exports=U},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],18:[function(t,e,n){(function(n){"use strict";function r(){r.init.call(this)}function i(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function o(t,e,n){if(e)t.call(n);else for(var r=t.length,i=h(t,r),o=0;r>o;++o)i[o].call(n)}function a(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=h(t,i),a=0;i>a;++a)o[a].call(n,r)}function s(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,a=h(t,o),s=0;o>s;++s)a[s].call(n,r,i)}function u(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var a=t.length,s=h(t,a),u=0;a>u;++u)s[u].call(n,r,i,o)}function l(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=h(t,i),a=0;i>a;++a)o[a].apply(n,r)}function c(t){const e=this._events;if(e){const n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function f(t,e){for(var n=e,r=n+1,i=t.length;i>r;n+=1,r+=1)t[n]=t[r];t.pop()}function h(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}var p;e.exports=r,r.EventEmitter=r,r.usingDomains=!1,r.prototype.domain=void 0,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var d=10;Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(t){console,d=t}}),r.init=function(){this.domain=null,r.usingDomains&&(p=p||t("domain"),!p.active||this instanceof p.Domain||(this.domain=p.active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events={},this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||0>t||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return i(this)},r.prototype.emit=function(t){var e,r,i,c,f,h,p,d=!1,_="error"===t;if(h=this._events)_=_&&null==h.error;else if(!_)return!1;if(p=this.domain,_){if(e=arguments[1],!p){if(e instanceof Error)throw e;var v=new Error('Uncaught, unspecified "error" event. ('+e+")");throw v.context=e,v}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=p,e.domainThrown=!1,p.emit("error",e),!1}if(r=h[t],!r)return!1;p&&this!==n&&(p.enter(),d=!0);var m="function"==typeof r;switch(i=arguments.length){case 1:o(r,m,this);break;case 2:a(r,m,this,arguments[1]);break;case 3:s(r,m,this,arguments[1],arguments[2]);break;case 4:u(r,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(c=new Array(i-1),f=1;i>f;f++)c[f-1]=arguments[f];l(r,m,this,c)}return d&&p.exit(),!0},r.prototype.addListener=function(t,e){var n,r,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return r=this._events,r?(r.newListener&&(this.emit("newListener",t,e.listener?e.listener:e),r=this._events),o=r[t]):(r=this._events={},this._eventsCount=0),o?("function"==typeof o?o=r[t]=[o,e]:o.push(e),o.warned||(n=i(this),n&&n>0&&o.length>n&&(o.warned=!0,console.error("warning: possible EventEmitter memory leak detected. %d %s listeners added. Use emitter.setMaxListeners() to increase limit.",o.length,t),console.trace()))):(o=r[t]=e,++this._eventsCount),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,i,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(r=this._events,!r)return this;if(n=r[t],!n)return this;if(n===e||n.listener&&n.listener===e)0===--this._eventsCount?this._events={}:(delete r[t],r.removeListener&&this.emit("removeListener",t,e));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){i=o;break}if(0>i)return this;if(1===n.length){if(n[0]=void 0,0===--this._eventsCount)return this._events={},this;delete r[t]}else f(n,i);r.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(n=this._events,!n)return this;if(!n.removeListener)return 0===arguments.length?(this._events={},this._eventsCount=0):n[t]&&(0===--this._eventsCount?this._events={}:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)r=i[o],"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events={},this._eventsCount=0,this}if(e=n[t],"function"==typeof e)this.removeListener(t,e);else if(e)do this.removeListener(t,e[e.length-1]);while(e[0]);return this},r.prototype.listeners=function(t){var e,n,r=this._events;return r?(e=r[t],n=e?"function"==typeof e?[e]:h(e,e.length):[]):n=[],n},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):c.call(t,e)},r.prototype.listenerCount=c}).call(this,t("_process"))},{_process:3,domain:1}],19:[function(t,e,n){var r=n;r.MD5=function(t){function e(t){var e=(t>>>0).toString(16);return"00000000".substr(0,8-e.length)+e}function n(t){for(var e=[],n=0;n<t.length;n++)e=e.concat(c(t[n]));return e}function r(t){for(var e=[],n=0;8>n;n++)e.push(255&t),t>>>=8;return e}function i(t,e){return t<<e&4294967295|t>>>32-e}function o(t,e,n){return t&e|~t&n}function a(t,e,n){return n&t|~n&e}function s(t,e,n){return t^e^n}function u(t,e,n){return e^(t|~n)}function l(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function c(t){for(var e=[],n=0;n<t.length;n++)if(t.charCodeAt(n)<=127)e.push(t.charCodeAt(n));else for(var r=encodeURIComponent(t.charAt(n)).substr(1).split("%"),i=0;i<r.length;i++)e.push(parseInt(r[i],16));return e}function f(t,n,r,i){for(var o="",a=0,s=0,u=3;u>=0;u--)s=arguments[u],a=255&s,s>>>=8,a<<=8,a|=255&s,s>>>=8,a<<=8,a|=255&s,s>>>=8,a<<=8,a|=s,o+=e(a);return o}function h(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=t[n];return e}function p(t,e){return 4294967295&t+e}function d(){function t(t,e,n,r){var o=w;w=b,b=g,g=p(g,i(p(y,p(t,p(e,n))),r)),y=o}var e=_.length;_.push(128);var n=_.length%64;if(n>56){for(var c=0;64-n>c;c++)_.push(0);n=_.length%64}for(c=0;56-n>c;c++)_.push(0);_=_.concat(r(8*e));var h=1732584193,d=4023233417,v=2562383102,m=271733878,y=0,g=0,b=0,w=0;for(c=0;c<_.length/64;c++){y=h,g=d,b=v,w=m;var E=64*c;t(o(g,b,w),3614090360,l(_,E),7),t(o(g,b,w),3905402710,l(_,E+4),12),t(o(g,b,w),606105819,l(_,E+8),17),t(o(g,b,w),3250441966,l(_,E+12),22),t(o(g,b,w),4118548399,l(_,E+16),7),t(o(g,b,w),1200080426,l(_,E+20),12),t(o(g,b,w),2821735955,l(_,E+24),17),t(o(g,b,w),4249261313,l(_,E+28),22),t(o(g,b,w),1770035416,l(_,E+32),7),t(o(g,b,w),2336552879,l(_,E+36),12),t(o(g,b,w),4294925233,l(_,E+40),17),t(o(g,b,w),2304563134,l(_,E+44),22),t(o(g,b,w),1804603682,l(_,E+48),7),t(o(g,b,w),4254626195,l(_,E+52),12),t(o(g,b,w),2792965006,l(_,E+56),17),t(o(g,b,w),1236535329,l(_,E+60),22),t(a(g,b,w),4129170786,l(_,E+4),5),t(a(g,b,w),3225465664,l(_,E+24),9),t(a(g,b,w),643717713,l(_,E+44),14),t(a(g,b,w),3921069994,l(_,E),20),t(a(g,b,w),3593408605,l(_,E+20),5),t(a(g,b,w),38016083,l(_,E+40),9),t(a(g,b,w),3634488961,l(_,E+60),14),t(a(g,b,w),3889429448,l(_,E+16),20),t(a(g,b,w),568446438,l(_,E+36),5),t(a(g,b,w),3275163606,l(_,E+56),9),t(a(g,b,w),4107603335,l(_,E+12),14),t(a(g,b,w),1163531501,l(_,E+32),20),t(a(g,b,w),2850285829,l(_,E+52),5),t(a(g,b,w),4243563512,l(_,E+8),9),t(a(g,b,w),1735328473,l(_,E+28),14),t(a(g,b,w),2368359562,l(_,E+48),20),t(s(g,b,w),4294588738,l(_,E+20),4),t(s(g,b,w),2272392833,l(_,E+32),11),t(s(g,b,w),1839030562,l(_,E+44),16),t(s(g,b,w),4259657740,l(_,E+56),23),t(s(g,b,w),2763975236,l(_,E+4),4),t(s(g,b,w),1272893353,l(_,E+16),11),t(s(g,b,w),4139469664,l(_,E+28),16),t(s(g,b,w),3200236656,l(_,E+40),23),t(s(g,b,w),681279174,l(_,E+52),4),t(s(g,b,w),3936430074,l(_,E),11),t(s(g,b,w),3572445317,l(_,E+12),16),t(s(g,b,w),76029189,l(_,E+24),23),t(s(g,b,w),3654602809,l(_,E+36),4),t(s(g,b,w),3873151461,l(_,E+48),11),t(s(g,b,w),530742520,l(_,E+60),16),t(s(g,b,w),3299628645,l(_,E+8),23),t(u(g,b,w),4096336452,l(_,E),6),t(u(g,b,w),1126891415,l(_,E+28),10),t(u(g,b,w),2878612391,l(_,E+56),15),t(u(g,b,w),4237533241,l(_,E+20),21),t(u(g,b,w),1700485571,l(_,E+48),6),t(u(g,b,w),2399980690,l(_,E+12),10),t(u(g,b,w),4293915773,l(_,E+40),15),t(u(g,b,w),2240044497,l(_,E+4),21),t(u(g,b,w),1873313359,l(_,E+32),6),t(u(g,b,w),4264355552,l(_,E+60),10),t(u(g,b,w),2734768916,l(_,E+24),15),t(u(g,b,w),1309151649,l(_,E+52),21),t(u(g,b,w),4149444226,l(_,E+16),6),t(u(g,b,w),3174756917,l(_,E+44),10),t(u(g,b,w),718787259,l(_,E+8),15),t(u(g,b,w),3951481745,l(_,E+36),21),h=p(h,y),d=p(d,g),v=p(v,b),m=p(m,w)}return f(m,v,d,h).toLowerCase()}var _=null,v=null;return"string"==typeof t?_=c(t):t.constructor==Array?0===t.length?_=t:"string"==typeof t[0]?_=n(t):"number"==typeof t[0]?_=t:v=typeof t[0]:"undefined"!=typeof ArrayBuffer?t instanceof ArrayBuffer?_=h(new Uint8Array(t)):t instanceof Uint8Array||t instanceof Int8Array?_=h(t):t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Float32Array||t instanceof Float64Array?_=h(new Uint8Array(t.buffer)):v=typeof t:v=typeof t,v&&alert("MD5 type mismatch, cannot process "+v),d()}},{}],20:[function(t,e,n){"use strict";const r={};r[5e8]=!0,delete r[5e8];const i=setTimeout,o=clearTimeout;self.setTimeout=function(t,e){if(e=+e,e>=100){var n=!1,o=function(){n||(n=!0,delete r[a],t())},a=i.call(self,o,e);return r[a]={callback:o,deadline:Date.now()+e},a}return i.apply(self,arguments)},self.clearTimeout=function(t){return delete r[t],o.apply(self,arguments)},e.exports=function(){var t=Object.keys(r),e=Date.now(),n=[];for(o=0;o<t.length;++o){var i=r[t[o]];e>=i.deadline&&n.push(i)}n.sort(function(t,e){return t.deadline-e.deadline});for(var o=0;o<n.length;++o)n[o].callback()}},{}],21:[function(t,e,n){"use strict";var r=function(){const t=32768,e=Math.log(t)*Math.LOG2E|0,n=new Array(e),r=new Array(e),i=function(t){var e=Math.log(t)*Math.LOG2E|0;if(void 0===n[e]){for(var r=new Float64Array(t),i=new Float64Array(t),o=0;t>o;++o)r[o]=Math.sin(2*Math.PI*o/t),i[o]=Math.cos(2*Math.PI*o/t);n[e]={cos:i,sin:r}}return n[e]},o=function(t){const e=Math.log(t)*Math.LOG2E|0;return void 0===r[e]&&(r[e]=new Float64Array(t<<2)),r[e]},a=function(t,e){return t=t>>>1&1431655765|(1431655765&t)<<1,t=t>>>2&858993459|(858993459&t)<<2,t=t>>>4&252645135|(252645135&t)<<4,t=t>>>8&16711935|(16711935&t)<<8,t=t>>>16|t<<16,t>>>32-e},s=function(t){const e=t.length,n=e>>1,r=n>>1,i=n,a=e,s=o(n);s[0]=t[0],s[i]=0,s[r]=t[r<<1],s[i+r]=0,s[a]=t[1],s[a+i]=0,s[a+r]=t[(r<<1)+1],s[a+i+r]=0;for(var u=1;n>u;++u){var l=t[u<<1],c=t[(u<<1)+1],f=t[n-u<<1],h=t[(n-u<<1)+1];s[u]=(l+f)/2,s[i+u]=(c-h)/2,s[a+u]=(c+h)/2,s[a+i+u]=(f-l)/2}},u=function(t){const e=t.length,n=e>>1,r=n,i=e,a=o(n);for(var s=2*Math.pow(Math.sin(-Math.PI/e),2),u=Math.sin(2*-Math.PI/e),l=1,c=0,f=0;n>f;++f){var h=a[f],p=a[r+f],d=a[i+f],_=a[i+r+f],v=h+d*l-_*c,m=p+d*c+_*l;t[f]=v,t[r+f]=m;var y=l-(s*l+u*c),g=c+(u*l-s*c);l=y,c=g}},l=function(t){const e=t.length>>1,n=Math.log(e)*Math.LOG2E|0;for(var r=0;e>r;++r){var i=a(r,n);if(i>r){var o=r<<1,s=i<<1,u=t[o],l=t[o+1];t[o]=t[s],t[o+1]=t[s+1],t[s]=u,t[s+1]=l}}},c=function(t){const e=(2*Math.PI,t.length>>1),n=i(e),r=n.sin,o=n.cos;for(var a=2;e>=a;a<<=1)for(var s=a>>1,u=e/a,l=0;e>l;l+=a)for(var c=l+s,f=0,h=l;c>h;h++){var p=o[f],d=r[f],_=h<<1,v=h+s<<1,m=t[v]*p+t[v+1]*d,y=-t[v]*d+t[v+1]*p;t[v]=t[_]-m,t[v+1]=t[_+1]-y,t[_]+=m,t[_+1]+=y,f+=u}};return function(e){const n=e.length;if(0!==(n&n>>>1))throw new Error("array size must be a power of two");if(n>t)throw new Error("maximum size is: 32768");1>=n||(l(e),c(e),s(e),u(e))}}();e.exports=r},{}],22:[function(t,e,n){!function(t){"use strict";function n(t,e,n){return t>=e&&n>=t}function r(t,e){return-1!==e.indexOf(t)}function i(t,e){return-1===e.indexOf(t)}function o(t){if(void 0===t)return{};if(t===Object(t))return t;throw TypeError("Could not convert argument to dictionary")}function a(t){for(var e=String(t),n=e.length,r=0,i=[];n>r;){var o=e.charCodeAt(r);if(55296>o||o>57343)i.push(o);else if(o>=56320&&57343>=o)i.push(65533);else if(o>=55296&&56319>=o)if(r===n-1)i.push(65533);else{var a=t.charCodeAt(r+1);if(a>=56320&&57343>=a){var s=1023&o,u=1023&a;i.push(65536+(s<<10)+u),r+=1}else i.push(65533)}r+=1}return i}function s(t){for(var e="",n=0;n<t.length;++n){var r=t[n];65535>=r?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(1023&r)+56320))}return e}function u(t){return t>=0&&127>=t}function l(t){this.tokens=[].slice.call(t),this.tokens.reverse()}function c(t,e){if(t)throw TypeError("Decoder error");return e||65533}function f(t){throw TypeError("The code point "+t+" could not be encoded.")}function h(){}function p(){}function d(t){return t=String(t).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(M,t)?M[t]:null}function _(t,e){var n=e.indexOf(t);return-1===n?null:n}function v(e){if(!("encoding-indexes"in t))throw Error("Indexes missing. Did you forget to include encoding-indexes.js?");return t["encoding-indexes"][e]}function m(t,e){if(!(this instanceof m))throw TypeError("Called as a function. Did you forget 'new'?");t=void 0!==t?String(t):B,e=o(e),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode=j,this._do_not_flush=!1;var n=d(t);if(null===n||"replacement"===n.name)throw RangeError("Unknown encoding: "+t);if(!L[n.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js?");var r=this;return r._encoding=n,Boolean(e.fatal)&&(r._error_mode=I),Boolean(e.ignoreBOM)&&(r._ignoreBOM=!0),Object.defineProperty||(this.encoding=r._encoding.name,this.fatal=r._error_mode,this.ignoreBOM=r._ignoreBOM),r}function y(t,e){if(!(this instanceof y))throw TypeError("Called as a function. Did you forget 'new'?");t=void 0!==t?String(t):B,e=o(e),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=Boolean(e.fatal);var n=d(t);if(null===n||"replacement"===n.name||i(n.name,["utf-8","utf-16le","utf-16be"])&&!Boolean(e.NONSTANDARD_allowLegacyEncoding))throw RangeError("Unknown encoding: "+t);if(!P[n.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");var r=this;return r._encoding=n,Object.defineProperty||(this.encoding=r._encoding.name),r}function g(t){var e=t.fatal,r=0,i=0,o=0,a=128,s=191;this.handler=function(t,u){if(u===F&&0!==o)return o=0,c(e);if(u===F)return T;if(0===o){if(n(u,0,127))return u;if(n(u,194,223))o=1,r=u-192;else if(n(u,224,239))224===u&&(a=160),237===u&&(s=159),o=2,r=u-224;else{if(!n(u,240,244))return c(e);240===u&&(a=144),244===u&&(s=143),o=3,r=u-240}return r<<=6*o,null}if(!n(u,a,s))return r=o=i=0,a=128,s=191,t.prepend(u),c(e);if(a=128,s=191,i+=1,r+=u-128<<6*(o-i),i!==o)return null;var l=r;return r=o=i=0,l}}function b(t){t.fatal;this.handler=function(t,e){if(e===F)return T;if(n(e,0,127))return e;var r,i;n(e,128,2047)?(r=1,i=192):n(e,2048,65535)?(r=2,i=224):n(e,65536,1114111)&&(r=3,i=240);for(var o=[(e>>6*r)+i];r>0;){var a=e>>6*(r-1);o.push(128|63&a),r-=1}return o}}function w(t,e){var n=e.fatal;this.handler=function(e,r){if(r===F)return T;if(u(r))return r;var i=t[r-128];return null===i?c(n):i}}function E(t,e){e.fatal;this.handler=function(e,n){if(n===F)return T;if(S(n))return n;var r=_(n,t);return null===r&&f(n),r+128}}function C(t,e){var n=t>>8,r=255&t;return e?[n,r]:[r,n]}function A(t,e){var r=e.fatal,i=null,o=null;this.handler=function(e,a){if(a===F&&(null!==i||null!==o))return c(r);if(a===F&&null===i&&null===o)return T;if(null===i)return i=a,null;var s;if(s=t?(i<<8)+a:(a<<8)+i,i=null,null!==o){var u=o;return o=null,n(s,56320,57343)?65536+1024*(u-55296)+(s-56320):(e.prepend(C(s,t)),c(r))}return n(s,55296,56319)?(o=s,null):n(s,56320,57343)?c(r):s}}function k(t,e){e.fatal;this.handler=function(e,r){if(r===F)return T;if(n(r,0,65535))return C(r,t);var i=C((r-65536>>10)+55296,t),o=C((r-65536&1023)+56320,t);return i.concat(o)}}function x(t){t.fatal;this.handler=function(t,e){return e===F?T:u(e)?e:63360+e-128}}function R(t){t.fatal;this.handler=function(t,e){return e===F?T:S(e)?e:n(e,63360,63487)?e-63360+128:f(e)}}t["encoding-indexes"]={"windows-1252":[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]};var S=(Math.floor,u),F=-1;l.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():F},prepend:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.push(e.pop());else this.tokens.push(t)},push:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.unshift(e.shift());else this.tokens.unshift(t)}};var T=-1,j=!1,I=!0;h.prototype={handler:function(t,e){}},p.prototype={handler:function(t,e){}};var O=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],name:"windows-1252"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["utf-16be"],name:"utf-16be"},{labels:["utf-16","utf-16le"],name:"utf-16le"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],M={};O.forEach(function(t){t.encodings.forEach(function(t){t.labels.forEach(function(e){M[e]=t})})});var P={},L={},B="utf-8";Object.defineProperty&&(Object.defineProperty(m.prototype,"encoding",{get:function(){return this._encoding.name}}),Object.defineProperty(m.prototype,"fatal",{get:function(){return this._error_mode===I}}),Object.defineProperty(m.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}})),m.prototype.decode=function(t,e){function n(t){return!r(this.encoding,["utf-8","utf-16le","utf-16be"])||this._ignoreBOM||this._BOMseen||(t.length>0&&65279===t[0]?(this._BOMseen=!0,t.shift()):t.length>0&&(this._BOMseen=!0)),s(t)}var i;i="object"==typeof t&&t instanceof ArrayBuffer?new Uint8Array(t):"object"==typeof t&&"buffer"in t&&t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(0),e=o(e),this._do_not_flush||(this._decoder=L[this._encoding.name]({fatal:this._error_mode}),this._BOMseen=!1),this._do_not_flush=Boolean(e.stream);for(var a,u=new l(i),c=[];;){var f=u.read();if(f===F)break;if(a=this._decoder.handler(u,f),a===T)break;null!==a&&(Array.isArray(a)?c.push.apply(c,a):c.push(a))}if(!this._do_not_flush){do{if(a=this._decoder.handler(u,u.read()),a===T)break;null!==a&&(Array.isArray(a)?c.push.apply(c,a):c.push(a))}while(!u.endOfStream());this._decoder=null}return n.call(this,c)},Object.defineProperty&&Object.defineProperty(y.prototype,"encoding",{get:function(){return this._encoding.name}}),y.prototype.encode=function(t,e){t=t?String(t):"",e=o(e),this._do_not_flush||(this._encoder=P[this._encoding.name]({fatal:this._fatal})),this._do_not_flush=Boolean(e.stream);for(var n,r=new l(a(t)),i=[];;){var s=r.read();if(s===F)break;if(n=this._encoder.handler(r,s),n===T)break;Array.isArray(n)?i.push.apply(i,n):i.push(n)}if(!this._do_not_flush){for(;;){if(n=this._encoder.handler(r,r.read()),n===T)break;Array.isArray(n)?i.push.apply(i,n):i.push(n)}this._encoder=null}return new Uint8Array(i)},P["utf-8"]=function(t){return new b(t)},L["utf-8"]=function(t){return new g(t)},function(){"encoding-indexes"in t&&O.forEach(function(t){"Legacy single-byte encodings"===t.heading&&t.encodings.forEach(function(t){var e=t.name,n=v(e);L[e]=function(t){return new w(n,t)},P[e]=function(t){return new E(n,t)}})})}(),P["utf-16be"]=function(t){return new k(!0,t)},L["utf-16be"]=function(t){return new A(!0,t)},P["utf-16le"]=function(t){return new k(!1,t)},L["utf-16le"]=function(t){return new A(!1,t)},P["x-user-defined"]=function(t){return new R(t)},L["x-user-defined"]=function(t){return new x(t)},t.TextEncoder||(t.TextEncoder=y),t.TextDecoder||(t.TextDecoder=m),"undefined"!=typeof e&&e.exports&&(e.exports={TextEncoder:t.TextEncoder,TextDecoder:t.TextDecoder,EncodingIndexes:t["encoding-indexes"]})}(self)},{}],23:[function(t,e,n){"use strict";const r=t("lib/bluebird"),i=t("lib/events");var o=e.exports,a=Function.prototype.bind;Function.prototype.bind=function(t){if(arguments.length>1)return a.apply(this,arguments);var e=this;return function(){return e.apply(t,arguments)}},"function"!=typeof Math.denormz&&Object.defineProperty(Math,"denormz",{value:function(){const t=new Uint16Array(1),e=new Uint8Array(t.buffer);e[0]=255;const n=255===t[0]?1:0,r=new Float64Array(1),i=new Int32Array(r.buffer);return function(t){return r[0]=t,0===(2146435072&i[n])?0:t}}()}),"function"!=typeof Math.fdzround&&Object.defineProperty(Math,"fdzround",{value:function(){const t=new Float32Array(1),e=new Int32Array(t.buffer);return function(n){return n=Math.fround(n),t[0]=n,0===(2139095040&e[0])?0:n}}()}),"function"!=typeof Math.gcd&&Object.defineProperty(Math,"gcd",{value:function(t,e){return 0===e?t:gcd(e,t%e)}}),o.queryString=function(t){return Object.keys(t).map(function(e){return e+"="+t[e]}).join("&")},o.combineClasses=function(t,e){return t?t+" "+e:e},o.modifierKey=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl",o.modifierKeyProp=o.modifierKey+"Key",o.arrayEquals=function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0},o.toFunction=function(t){return"function"==typeof t?t:function(){return t}};const s=/textarea|input|select/i,u=/^(?:text|search|tel|url|email|password|number)$/i;o.isTextInputNode=function(t){return s.test(t.nodeName)?"input"!==t.nodeName.toLowerCase()?!0:u.test(t.type)?!0:!1:t.isContentEditable?!0:!1},o.onCapture=function(t,e,n){e.split(" ").forEach(function(e){t.addEventListener(e,n,!0)})},o.offCapture=function(t,e,n){e.split(" ").forEach(function(e){t.removeEventListener(e,n,!0)})},o.onBubble=function(t,e,n){e.split(" ").forEach(function(e){t.addEventListener(e,n,!1)})},o.offBubble=function(t,e,n){e.split(" ").forEach(function(e){t.removeEventListener(e,n,!1)})},o.bits=function(){const t=new Int32Array([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,4294967295]);return function(e,n,r){return e>>>n&t[r]}}(),o.bit=function(t,e){return 1===o.bits(t,e,1)},o.synchInt32=function(t,e){return(255&t.charCodeAt(e+0)&127)<<21|(255&t.charCodeAt(e+1)&127)<<14|(255&t.charCodeAt(e+2)&127)<<7|255&t.charCodeAt(e+3)&127},o.int24BE=function(t,e){return(255&t.charCodeAt(e+0))<<16|(255&t.charCodeAt(e+1))<<8|255&t.charCodeAt(e+2)},o.int32BE=function(t,e){return(255&t.charCodeAt(e+0))<<24|(255&t.charCodeAt(e+1))<<16|(255&t.charCodeAt(e+2))<<8|255&t.charCodeAt(e+3)},o.int16BE=function(t,e){return(255&t.charCodeAt(e+0))<<8|255&t.charCodeAt(e+1)},o.int32LE=function(t,e){return(255&t.charCodeAt(e+3))<<24|(255&t.charCodeAt(e+2))<<16|(255&t.charCodeAt(e+1))<<8|255&t.charCodeAt(e+0)},o.int16LE=function(t,e){return(255&t.charCodeAt(e+1))<<8|255&t.charCodeAt(e+0)},function(){const t=0,e=1,n=new Uint16Array(1),r=new Uint8Array(n.buffer);r[0]=255;const i=255===n[0]?t:e,a=new Float32Array(1),s=new Uint8Array(a.buffer),u=new Int32Array(a.buffer),l=new Uint32Array(a.buffer),c=new Float64Array(1),f=new Uint8Array(c.buffer);i===t?o.float32BE=function(t,e){return s[0]=255&t.charCodeAt(e+3),s[1]=255&t.charCodeAt(e+2),s[2]=255&t.charCodeAt(e+1),s[3]=255&t.charCodeAt(e+0),a[0]}:o.float32BE=function(t,e){return s[3]=255&t.charCodeAt(e+3),s[2]=255&t.charCodeAt(e+2),s[1]=255&t.charCodeAt(e+1),s[0]=255&t.charCodeAt(e+0),a[0]},i===t?o.float32BEString=function(t){return a[0]=t,String.fromCharCode(s[3])+String.fromCharCode(s[2])+String.fromCharCode(s[1])+String.fromCharCode(s[0])}:o.float32BEString=function(t){return a[0]=t,String.fromCharCode(s[0])+String.fromCharCode(s[1])+String.fromCharCode(s[2])+String.fromCharCode(s[3])},i===t?o.int32BEString=function(t){return u[0]=0|t,String.fromCharCode(s[3])+String.fromCharCode(s[2])+String.fromCharCode(s[1])+String.fromCharCode(s[0])}:o.int32BEString=function(t){return u[0]=0|t,String.fromCharCode(s[0])+String.fromCharCode(s[1])+String.fromCharCode(s[2])+String.fromCharCode(s[3])},i===t?o.uint32BEString=function(t){return l[0]=t>>>0,String.fromCharCode(s[3])+String.fromCharCode(s[2])+String.fromCharCode(s[1])+String.fromCharCode(s[0])}:o.uint32BEString=function(t){return l[0]=t>>>0,String.fromCharCode(s[0])+String.fromCharCode(s[1])+String.fromCharCode(s[2])+String.fromCharCode(s[3])},i===t?o.float32LE=function(t,e){return s[3]=255&t.charCodeAt(e+3),s[2]=255&t.charCodeAt(e+2),s[1]=255&t.charCodeAt(e+1),s[0]=255&t.charCodeAt(e+0),a[0]}:o.float32LE=function(t,e){return s[0]=255&t.charCodeAt(e+3),s[1]=255&t.charCodeAt(e+2),s[2]=255&t.charCodeAt(e+1),s[3]=255&t.charCodeAt(e+0),a[0]},i===t?o.float64BE=function(t,e){return f[0]=255&t.charCodeAt(e+7),f[1]=255&t.charCodeAt(e+6),f[2]=255&t.charCodeAt(e+5),f[3]=255&t.charCodeAt(e+4),f[4]=255&t.charCodeAt(e+3),f[5]=255&t.charCodeAt(e+2),f[6]=255&t.charCodeAt(e+1),f[7]=255&t.charCodeAt(e+0),c[0]}:o.float64BE=function(t,e){return f[7]=255&t.charCodeAt(e+7),f[6]=255&t.charCodeAt(e+6),f[5]=255&t.charCodeAt(e+5),f[4]=255&t.charCodeAt(e+4),f[3]=255&t.charCodeAt(e+3),f[2]=255&t.charCodeAt(e+2),f[1]=255&t.charCodeAt(e+1),f[0]=255&t.charCodeAt(e+0),c[0]},i===t?o.float64LE=function(t,e){return f[7]=255&t.charCodeAt(e+7),f[6]=255&t.charCodeAt(e+6),f[5]=255&t.charCodeAt(e+5),f[4]=255&t.charCodeAt(e+4),f[3]=255&t.charCodeAt(e+3),f[2]=255&t.charCodeAt(e+2),f[1]=255&t.charCodeAt(e+1),f[0]=255&t.charCodeAt(e+0),c[0]}:o.float64LE=function(t,e){return f[0]=255&t.charCodeAt(e+7),f[1]=255&t.charCodeAt(e+6),f[2]=255&t.charCodeAt(e+5),f[3]=255&t.charCodeAt(e+4),f[4]=255&t.charCodeAt(e+3),f[5]=255&t.charCodeAt(e+2),f[6]=255&t.charCodeAt(e+1),f[7]=255&t.charCodeAt(e+0),c[0]}}(),o.truncateUp=function(t){return 0>t?Math.floor(t):Math.ceil(t)},o.toTimeString=function(t){if(!isFinite(t)||null==t)return"";var e=0>t?-1:1;t=Math.floor(Math.abs(t));var n,r,i,o;return n=t/86400>>0,r=t%86400/3600>>0,i=t%3600/60>>0,o=t%60,o=10>o?"0"+o:o,i=10>i?"0"+i:i,r=r&&10>r?"0"+r:r,(-1===e?"-":"")+(n?n+" - ":"")+(r?r+":":"")+i+":"+o},o.shortNumber=function(t){t=+t;var e=0>t?"-":"";return t=Math.abs(t),1e3>t?e+t+"":1e6>t?e+Math.round(t/1e3).toFixed(1)+"k":1e9>t?e+Math.round(t/1e6).toFixed(1)+"m":1e12>t?e+Math.round(t/1e9).toFixed(1)+"g":e+t.toExponential(0)},o.perfectScrollBarPostUpdate=function(t){var e=t.scrollTop,n=t.scrollLeft;t.scrollTop=0,t.scrollLeft=0;var r=document.createEvent("Event");r.initEvent("scroll",!0,!0),t.dispatchEvent(r),t.scrollTop=e,t.scrollLeft=n;var r=document.createEvent("Event");r.initEvent("scroll",!0,!0),t.dispatchEvent(r)},o.scrollUp=function(t,e){t.scrollTop=t.scrollTop-e;var n=document.createEvent("Event");n.initEvent("scroll",!0,!0),t.dispatchEvent(n)},o.scrollDown=function(t,e){t.scrollTop=t.scrollTop+e;var n=document.createEvent("Event");n.initEvent("scroll",!0,!0),t.dispatchEvent(n)},o.scrollIntoView={alignMiddle:function(t,e){if(t&&e){var n,r=t.offsetTop,i=e.offsetHeight;n=r-i/2,0>n&&(n=0),e.scrollTop=n;var o=document.createEvent("Event");o.initEvent("scroll",!0,!0),e.dispatchEvent(o);
}}},o.inherits=function(t,e){function n(){this.constructor=t,this.constructor$=e;for(var n in e.prototype)r.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var r={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},o.throttle=function(t,e){var n=-1,r=0;return function(){-1!==n&&(clearTimeout(n),n=-1);for(var i=++r,o=new Array(arguments.length),a=0;a<o.length;++a)o[a]=arguments[a];var s=this;n=setTimeout(function(){r===i&&(r=0,n=-1,t.apply(s,o))},e)}},o.debounce=function(t,e){var n=0;return function(){var r=Date.now(),i=r-n;return i>=e?(n=r,t.apply(this,arguments)):void 0}},o.callableEveryMs=function(t,e){var n=0;return function(){var r=Date.now();return r-n>e?(n=r,t.apply(this,arguments)):void 0}},"function"!=typeof String.prototype.htmlEncode&&(String.prototype.htmlEncode=function(){var t=new RegExp('"',"g");return function(){var e,n=document.createElement("DIV"),r=this.toString();return n.innerText=n.textContent=r,e=n.innerHTML,e.replace(t,"&quot;")}}()),"function"!=typeof Array.prototype.first&&(Array.prototype.first=function(){return this.length>0?this[0]:void 0}),"function"!=typeof Array.prototype.last&&(Array.prototype.last=function(){var t=this.length;return t>0?this[t-1]:void 0}),"function"!=typeof Math.log10&&(Math.log10=function(t){return Math.log(t)*Math.LOG10E}),"function"!=typeof Math.log2&&(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Array.prototype.toKeysObj=function(){var t=0,e=this.length,n={};for(t=0;e>t;++t)n[this[t]]=null;return n},o.IDENTITY=function(t){return t},o.buildConsecutiveRanges=function(t,e){if("function"!=typeof e&&(e=o.IDENTITY),!t.length)return[];if(1===t.length)return[[t[0]]];for(var n=[],r=t[0],i=[r],a=1;a<t.length;++a){var s=e(t[a]),u=e(r);s!==u&&(s-1!==u?(n.push(i),i=[t[a]]):i.push(t[a]),r=t[a])}return n.push(i),n},o.buildInverseRanges=function(t,e){var n=[],r=o.buildConsecutiveRanges(t);if(!r.length)return[[0,e]];var i=0===r.first().first()?-1:0,a=-1;return r.forEach(function(t){var e=t.first(),r=t.last();e===r?-1===i?i=r+1:(n.push([i,0===e?i:e-1]),i=r+1,a=-1):-1===i?i=0===e?r+1:e-1:(n.push([i,e-1]),i=r+1)}),-1!==i?e>=i&&n.push([i,e]):-1!==a&&e>=a&&n.push([a,e]),n},o.indexMapper=function(t){return t.getIndex()},o.TRACK_SORTER=function(t,e){return t.getIndex()-e.getIndex()},o.SORT_NUMBER_ASC=function(t,e){return t-e},o.once=function(t,e,n){t.addEventListener(e,function r(){try{t.removeEventListener(e,r,!1)}finally{n.apply(this,arguments)}},!1)};const l=function(t,e){if(t!==e){var n;return 0===e?(n=new Error("file not found"),n.name="NotFoundError"):(n=new Error("read failed"),n.name="NotReadableError"),n}return null};o.readAsBinaryString=function(t){var e=t.size;return new r("function"!=typeof FileReader?function(n){var r=new FileReaderSync;result=r.readAsBinaryString(t),t=null;var i=l(e,result.length);if(i)throw i;n(result)}:function(n,r){var i=new FileReader;o.once(i,"load",function(o){i=null,t=null;var a=o.target.result,o=l(e,a.length);o?r(o):n(a)}),o.once(i,"error",function(){i=null,t=null;var e=new Error(this.error.message);e.name=this.error.name,r(e)}),i.readAsBinaryString(t)})},o.readAsArrayBuffer=function(t){var e=t.size;return new r("function"!=typeof FileReader?function(n){var r=new FileReaderSync,i=r.readAsArrayBuffer(t);t=null;var o=l(e,i.byteLength);if(o)throw o;n(i)}:function(n,r){var i=new FileReader;o.once(i,"load",function(o){i=null,t=null;var a=o.target.result,o=l(e,a.byteLength);o?r(o):n(a)}),o.once(i,"error",function(){i=null,t=null;var e=new Error(this.error.message);e.name=this.error.name,r(e)}),i.readAsArrayBuffer(t)})},o.subClassError=function(t,e){var n=new Function("additional","return function "+t+"(message) {          this.name = '"+t+"';                                                        this.message = message;                                                        if (Error.captureStackTrace)                                                       Error.captureStackTrace(this);                                             else                                                                               Error.call(this, message);                                                 if (additional) additional.apply(this, arguments);                         };")(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n},o.formatTagString=function(t){var e=t.replace(/[\u0000-\u001F]+/g,"").trim();return e.length>512?e.slice(0,512):e},o.internString=function(){var t={"- ":0};return delete t["- "],function(e){t[e]=!0;var n=Object.keys(t)[0];return delete t[e],n}}(),o.indexOfCodePoint=function(t,e,n){void 0===n&&(n=0);for(var r=n;r<t.length;++r)if(t.charCodeAt(r)===e)return r;return-1},o.capitalize=function(t){return t.length?t.charAt(0).toUpperCase()+t.slice(1):t},o.unicode={},o.unicode.characterCategories={numbers:"0-9²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯୲-୷௦-௲౦-౯౸-౾೦-೯൦-൵෦-෯๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꧰-꧹꩐-꩙꯰-꯹０-９",letters:"A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞭꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",wordSeparator:"    - \u2028\u2029  　"},o.unicode.alphaNumericFilteringPattern=new RegExp("[^"+o.unicode.characterCategories.numbers+o.unicode.characterCategories.letters+"]+","g"),o.unicode.separateWordsPattern=new RegExp("["+o.unicode.characterCategories.wordSeparator+"]+","g");const c=Object.create(null);var f=0;o.addLegacyListener=function(t,e,n){var r=t.__legacyId;void 0===r&&(r=t.__legacyId=f++);var i=c[e];i||(i=c[e]=Object.create(null));var o=i[r];o||(o=i[r]=[],t["on"+e]=function(t){for(var e=0;e<o.length;++e)o[e].call(this,t)}),-1===o.indexOf(n)&&o.push(n)},o.slugTitle=function(t){return(t+"").toLowerCase().replace(/[^a-zA-Z0-9 \-_\$]/g,"").replace(/[\-_ ]/g,"-").replace(/\-+/g,"-").replace(/^\-|\-$/g,"")},o.removeLegacyListener=function(t,e,n){var r=c[e];if(r){var i=r[t.__legacyId];if(i){var o=i.indexOf(n);o>=0&&i.splice(o,1)}}},o.stripBinaryBom=function(t){return t.replace(/^(\xff\xfe|\xfe\xff)/,"")},o.asError=function(t){if(t instanceof Error)return t;var e=new Error;return e.message=""+(t?t.message:t),e},o.IDBPromisify=function(t){return new r(function(e,n){t.onerror=function(e){n(o.asError(e.target.transaction.error||t.error))},t.onsuccess=function(t){e(t.target.result)},t.oncomplete=e})},o.documentHidden=function(){if("undefined"!=typeof document){var t=["h","mozH","msH","webkitH"].reduce(function(t,e){return t?t:e+"idden"in document?e:t},null),e=t+"idden",n=t.slice(0,-1)+"visibilitychange",r=new i;r.setMaxListeners(99999999);var a;r.value=function(){return void 0===a?document[e]:a===!0?!0:document[e]},r.isBackgrounded=function(){return document[e]};var s=o.throttle(function(){r.emit("change")},10);return document.addEventListener(n,function(){document[e]?r.emit("background"):r.emit("foreground"),s()},!1),window.addEventListener("blur",function(){a=!0,s()},!1),window.addEventListener("focus",function(){a=!1,s()},!1),r}}(),o.titleCase=function(t){return"string"!=typeof t&&(t=""+t),t.charAt(0).toUpperCase()+t.slice(1)},o.assign=function(t){t=Object(t);for(var e=[].slice.call(arguments,1),n=0;n<e.length;++n)for(var r=e[n],i=Object.keys(r),o=0;o<i.length;++o){var a=i[o],s=r[a];t[a]=s}return t}},{"lib/bluebird":17,"lib/events":18}],24:[function(t,e,n){"use strict";const r=t("lib/util"),i=t("lib/jsmd5"),o=t("audio/demuxer"),a=4801587,s=5521735,u=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","Rhythm and Blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz & Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alternative Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap",["Pop","Funk"],"Jungle","Native US","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock ’n’ Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore Techno","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","Jpop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"],l=["Other","32x32 pixels 'file icon'","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. lable side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"],c=[new TextDecoder("iso-8859-1"),new TextDecoder("utf-16"),new TextDecoder("utf-16be"),new TextDecoder("utf-8")],f=function(t){return function(e,n,r,i,o,a){var s=n.getUint8(e);e++;var u=n.block(),l=n.start,f=1===s||2===s?2:1,p=h(e-l,u,o-1,f);if(p>0){var d=new Uint8Array(u.buffer,e-l,p),_=c[s];if(_){var v=_.decode(d).trim();v.length>512&&(v=v.slice(0,512)),"function"==typeof t?t(a,v):a[t]=v}}}},h=function(t,e,n,r){for(var i=0;n>i;i+=r){var o=t+i;if(0===e[o]&&(2===r?0===e[o+1]:!0))return i}return n},p=/\s*(\d+)\s*\/\s*(\d+)/,d={};d[5525553]=d[1414546737]=f("artist"),d[5526578]=d[1414091826]=f("title"),d[5521740]=d[1413565506]=f("album"),d[1414352719]=f("mood"),d[5526322]=d[1414745906]=d[5525554]=d[1414546738]=f("albumArtist"),d[5526091]=d[1414677323]=f(function(t,e){var n=p.exec(e);n?(t.trackNumber=+n[1],t.trackCount=+n[2]):(t.trackNumber=+e,t.trackCount=-1)}),d[5525569]=d[1414549331]=f(function(t,e){var n=p.exec(e);n?(t.discNumber=+n[1],t.discCount=+n[2]):(t.discNumber=+e,t.discCount=-1)}),d[5522256]=d[1413696848]=f(function(t,e){t.compilationFlag="1"===e}),d[5522e3]=d[1413632077]=f(function(t,e){t.beatsPerMinute=+e}),d[5527877]=d[1415136594]=f(function(t,e){t.year=+e});const _=/\((\d+)\)/g;d[5522255]=d[1413697358]=f(function(t,e){for(var n,r=0,i={};n=_.exec(e);){r=_.lastIndex;var o=u[+n[1]];Array.isArray(o)||(o=[o]);for(var a=0;a<o.length;++a)i[o[a].toLowerCase()]=o[a]}var s=e.slice(r).trim();if(s)for(var l=s.split(/\s*\/\s*/g),a=0;a<l.length;++a){var o=l[a].trim();i[o.toLowerCase()]=o}t.genres=Object.keys(i).map(function(t){return i[t]})}),d[5261635]=d[1095780675]=function(t,e,n,r,o,a){var s=t,u=e.getUint8(t);t++;var f,p=e.block(),d=e.start,_=-1,v=c[u];if(v){var m=1===u||2===u?2:1;if(2>=r)f="image/"+v.decode(new Uint8Array(p.buffer,t-d,3)),t+=3;else{var y=h(t-d,p,o-(t-s),1),g=v.decode(new Uint8Array(p.buffer,t-d,y)).toLowerCase();if(t+=y+1,-1===g.indexOf("/")){if(!/jpg|jpeg|png/.test(g))return;f="image/"+g}else f=g.toLowerCase()}_=e.getUint8(t),t++;var y=h(t-d,p,o-(t-s),m),b=v.decode(new Uint8Array(p.buffer,t-d,y));t+=y+m;var w=o-(t-s),d=e.start+t,E=a.pictures;E||(E=[],a.pictures=E);var a;if(n.hasBeenUnsynchronized){a=new Uint8Array(w);for(var C=0,A=0;w>A;++A){var k=t-e.start+A,x=p[k];255===x&&k+1<p.length&&0===p[k+1]&&++A,a[C]=x,C++}C!==w&&(a=new Uint8Array(a.buffer,t-e.start,C))}else a=new Uint8Array(p.buffer,t-e.start,w);var R=i.MD5(a),S=new Blob([a],{type:f});E.push({tag:R,blob:S,blobUrl:null,image:null,pictureKind:l[_],description:b})}};const v="[0-9A-F]{8}",m="([0-9A-F]{8})",y="[0-9A-F]{16}",g=new RegExp([v,m,m,y,v,v,v,v,v,v,v].join(" "));d[1129270605]=d[4411213]=function(t,e,n,r,i,o){var a=t,s=e.getUint8(t),u=e.block();t++;c[0].decode(new Uint8Array(u.buffer,t-e.start,3));t+=3;var l=c[s];if(l){var f=1===s||2===s?2:1,p=h(t-e.start,u,i-4,f),d=l.decode(new Uint8Array(u.buffer,t-e.start,p));t+=p+f,p=h(t-e.start,u,i-(t-a),f);var _=l.decode(new Uint8Array(u.buffer,t-e.start,p));if("iTunSMPB"===d||""===d){var v=g.exec(_.trim());v&&(o.encoderDelay=parseInt(v[1],16),o.encoderDelay=Math.min(65536,Math.max(0,o.encoderDelay)),o.encoderPadding=parseInt(v[2],16),o.encoderPadding=Math.min(65536,Math.max(0,o.encoderPadding)))}}};const b=function(t,e){return t.getUint8(e)<<21|t.getUint8(e+1)<<14|t.getUint8(e+2)<<7|t.getUint8(e+3)},w=function(t,e,n){var i=!1,o=!1,a=!1,s=!1,u=!1,l=!1,c=!1,f=!1;if(n>=3){var h=t.getUint16(e);i=r.bit(h,14),o=r.bit(h,13),a=r.bit(h,12),s=r.bit(h,6),u=r.bit(h,3),l=r.bit(h,2),c=r.bit(h,1),f=r.bit(h,0)}return{tagAlterPreservation:i,fileAlterPreservation:o,readOnly:a,containsGroupInfo:s,isCompressed:u,isEncrypted:l,hasBeenUnsynchronized:c,hasDataLengthIndicator:f}},E=function(t,e,n){var i=t.getUint8(e+5),o=r.bit(i,7),a=r.bit(i,6),s=r.bit(i,5),u=r.bit(i,4);return{hasBeenUnsynchronized:o,isExtended:a,isExperimental:s,hasFooter:u,invalidBits:0!==(15&i)}},C=function(t){return o("mp3",t,!0,262144).then(function(t){return t?{sampleRate:t.sampleRate,channels:t.channels,duration:t.duration}:null})},A=function(t,e,n){var r=b(e,n+6),i=e.getUint8(n+3),o=E(e,n),s=Promise.resolve();return i>=2&&4>=i&&!o.invalidBits?(n+r+10+3>e.end&&(s=e.readBlockOfSizeAt(r+8192+3,n)),s.then(function(){n+=10;var s=n+r,u=i>2?0:8,l=i>2?4:3,c=i>2?10:6;for(o.isExtended&&(n+=b(e,n));s>n+c;){var f=e.getUint32(n)>>>u|0;if(n+=l,0!==f){var h=i>3?b(e,n):e.getUint32(n)>>>u;n+=l;var p=w(n);if(i>2&&(n+=2),p.hasDataLengthIndicator&&(h=b(e,n),n+=4),p.hasBeenUnsynchronized=p.hasBeenUnsynchronized||o.hasBeenUnsynchronized,p.hasBeenUnsynchronized&&!p.hasDataLengthIndicator)for(var _=e.block(),v=e.start,m=0;h>m;++m){var y=n+m-v;255===_[y]&&0===_[y+1]&&h++}var g=d[f];g&&g(n,e,p,i,h,t),n+=h}}for(o.hasFooter&&(n+=10);n+c<e.end;){var f=e.getUint32(n);if(f>>>8===a)return A(t,e,n);if(0!==f)break;n+=4}})):void 0},k=function(t,e){for(var n=t.block(),r=30,i=0;30>i;++i)if(0===n[e+i-t.start]){r=i;break}var o=c[0];return o.decode(new Uint8Array(n.buffer,e-t.start,r))},x=function(t,e){var n=e.file.size-128;return e.readBlockOfSizeAt(128,n).then(function(){var r=n,i=c[0],o=e.block();if((e.getUint32(r)>>>8|0)===s){r+=3;var a=k(e,r);r+=30;var l=k(e,r);r+=30;var f=k(e,r);r+=30;var h=i.decode(new Uint8Array(o.buffer,r-e.start,4));r+=4;var p=e.getUint16(r+28),d=-1;0===(65280&p)&&(d=255&p),r+=30;var _=u[e.getUint8(r)];t.title=a,t.artist=l,t.album=f,t.year=+h,-1!==d&&(t.trackIndex=d),t.genres=Array.isArray(_)?_.slice():[_]}})},R=function(t,e){return C(e).then(function(n){n&&(t.basicInfo=n);const r=16384;return e.readBlockOfSizeAt(r,0).then(function(){if(e.end<r)return null;for(var n=0,i=e.block(),o=0;r>o;++o)if(n=n<<8|i[o]|0,n>>>8===a){var s=A(t,e,o-3);if(s)return s}return x(t,e)})["return"](t)})};e.exports=R},{"audio/demuxer":12,"lib/jsmd5":19,"lib/util":23}],25:[function(t,e,n){"use strict";var r=t("audio/Resampler");const i=Object.create(null),o=Object.create(null),a=Object.create(null),s=function(t,e){var n=t+" "+e,r=a[n];if(!r||!r.length){r=new Array(e);for(var i=0;e>i;++i)r[i]=new Float32Array(t);a[n]=[r]}return a[n].shift()},u=function(t,e,n){var r=t+" "+e;a[r].push(n)},l=function(t,e,n,i){i=i||0;var a=t+" "+e+" "+n,s=o[a];if(s||(s=o[a]={allocationCount:2,instances:[new r(t,e,n,i),new r(t,e,n,i)]}),0===s.instances.length&&(s.instances.push(new r(t,e,n,i)),s.allocationCount++,s.allocationCount>6))throw new Error("memory leak");var u=s.instances.shift();return u.start(),u},c=function(t){var e=t.nb_channels+" "+t.in_rate+" "+t.out_rate;o[e].instances.push(t),t.end()},f=function(t,e,n){var r=i[t];if(r||(r=i[t]={allocationCount:2,instances:[new e(n),new e(n)]}),0===r.instances.length&&(r.instances.push(new e(n)),r.allocationCount++,r.allocationCount>6))throw new Error("memory leak");return r.instances.shift()},h=function(t,e){e.removeAllListeners(),i[t].instances.push(e),e.end()};e.exports={allocResampler:l,freeResampler:c,allocDecoderContext:f,freeDecoderContext:h,allocBuffer:s,freeBuffer:u}},{"audio/Resampler":9}]},{},[10])(10)});